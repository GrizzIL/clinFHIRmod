<div>

    <style>
        .plain {
            font-weight: normal;
        }
        .profileElementScroll {
            height: 700px;
            overflow-y: scroll;
        }
        .selectedElement {
            font-weight: bold;
        }


    </style>
<div class="row">
    <div class="col-md-2 col-sm-2">

        <!--
            <div class="btn-group" ng-click="selectIG(input.igCode)">
                <label class="btn btn-default" ng-model="input.igCode" uib-btn-radio="'nzRegistry'">Identity</label>
            </div>

        -->

        <div class="row">
            <div class="col-sm-10 col-md-10">
                <strong style="font-size: large">Models</strong>
            </div>
            <div class="col-sm-2 col-md-2">
                <i class="glyphicon glyphicon-question-sign clickable" ng-click = "input.showModelHelp = ! input.showModelHelp"></i>
            </div>
        </div>

        <div class="list-group">
            <div class="designerScroll">
                <div ng-class="{'list-group-item':true,'listItemSelected':art==selectedArtifact}"
                     style="cursor: pointer"
                     ng-repeat="art in artifacts.logical">
                    <div ng-click="selectItem('logical',art)">
                        <div>{{art.reference.reference | referenceType}}</div>
                        {{art.name}}
                        <div>{{art.title}}</div>
                    </div>
                </div>
            </div>

        </div>
        <em>Each model is a single resource. Elements in the model map to Resource elements via the profile.</em>

    </div>
    <div class="col-md-10 col-sm-10">


        <div ng-show="input.showModelHelp || ! selectedResource">
            <div class="row">
                <div class="col-md-4" style="margin-top: 30px">
                    <p>Each model in the list to the left represents a single resource type that has been 'profiled' for
                        a particular purpose - such as adding the extra elements needed for a Patient in a particular
                        country. </p>

                    <p>This is a design artifact, and does not repesent the format used to actually share the resource. The model
                        is then converted into the formal artifacts - a profile and one or more extension definitions as shown
                        in the image to the right. </p>
                    <p>The profile adjusts the base elements of the resource type (eg it might
                        remove an element) and the extension definition describes the additional elements that are not present on the base.</p>

                    <p>It's quite possible for a single resource type to have multiple models - for example this is quite common
                        with Observations. It's also common (in fact preferred) for the same Extension Definition to be used in
                        multiple models if they mean the same thing.</p>
                </div>
                <div class="col-md-6">
                    <img src="/content/nhip/lm2profile.png"/>
                </div>
            </div>
        <hr/>




        </div>

        <div ng-show="selectedGroup == 'logical' && selectedResource ">



            <uib-tabset ng-show="selectedArtifact">

                <uib-tab heading="Description">
                    <br/>
                    <div ng-hide="arDocs.length > 0" >
                        <br/>
                        <div class="row">
                            <div class="col-md-2">
                                Purpose
                            </div>
                            <div class="col-md-10">

                                <p ng-bind-html="selectedResource.purpose | markDown"></p>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                Last updated
                            </div>
                            <div class="col-md-10">
                                {{selectedResource.meta.lastUpdated | date}}  {{selectedResource.meta.lastUpdated | getAgeSeconds:true}}
                            </div>
                        </div>
                        <!--<pre>{{selectedResource | json}}</pre>
                        <pre>{{selectedArtifact | json}}</pre>-->

                        <div ng-show="selectedArtifact.profileForLM">
                            <div class="row">
                                <div class="col-md-2">
                                    Profile
                                </div>
                                <div class="col-md-5">
                                    {{appConfigSvc.getCurrentConformanceServer().url}}{{selectedArtifact.profileForLM}}
                                </div>
                                <div class="col-md-5">
                                    <em>This is the location of the formal FHIR Profile for this Logical Model (ie, how an instance will be represented 'on the wire')</em>
                                </div>
                            </div>

                        </div>


                    </div>

                    <div class="doc" ng-repeat = "doc in arDocs">
                        <p ng-bind-html="doc.contents | markDown"></p>
                    </div>



                </uib-tab>

                <uib-tab heading="Tree view">
                    <br/>
                    <div class="row">
                        <div class="col-md-3 col-sm-3">
                            <div class="designerScroll" id="lmTreeView"></div>

                        </div>
                        <div class="col-md-9 col-sm-9">
                            <div ng-show="selectedNode">
                                <div class="row">
                                    <div class="col-md-8 col-sm-8">
                                        <h4>{{selectedNode.text}}</h4>

                                    </div>
                                    <div class="col-md-4 col-sm-4">
                                        <div class="pull-right">
                                            <input style="margin-top: 15px"
                                                   ng-click="setClinicalView(clinicalView)"
                                                   type = "checkbox" ng-model="clinicalView"/> Clinical View
                                        </div>

                                    </div>
                                </div>

                                <table class="table table-bordered">



                                    <tr  ng-show="selectedNode.parent == '#'">
                                        <td width="20%">Base type</td>
                                        <td>{{baseTypeForModel}} </td>
                                    </tr>

                                    <tr>
                                        <td width="20%">Name</td>
                                        <td>{{selectedNode.data.name}} </td>
                                    </tr>

                                    <tr><td>Must Support</td><td>{{selectedNode.data.mustSupport}}</td></tr>

                                    <tr ng-show = "selectedNode.data.edStatus && (selectedNode.data.edStatus !== 'included')" class="required">
                                        <td>Status</td><td>{{selectedNode.data.edStatus}}

                                        <span class="pull-right"><em>{{statusDescription[selectedNode.data.edStatus]}}</em></span>


                                    </td>
                                    </tr>


                                    <tr ng-show="selectedNode.data.lmReviewReason">
                                        <td>Reason for review</td>
                                        <td>
                                            {{selectedNode.data.lmReviewReason}}

                                        </td>
                                    </tr>
                                    <tr ng-show="selectedNode.data.alias">
                                        <td width="20%">Alias</td>
                                        <td>
                                            <ul>
                                                <li ng-repeat="al in selectedNode.data.alias track by $index">
                                                    {{al}}
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>





                                    <tr><td>Short</td><td>{{selectedNode.data.short}}</td></tr>
                                    <tr><td>Description</td>
                                        <td>
                                            {{selectedNode.data.description}}

                                        </td>
                                    </tr>





                                    <tr ng-show="selectedNode.data.usageGuide">
                                        <td>Usage Guide</td>
                                        <td>
                                            {{selectedNode.data.usageGuide}}

                                        </td>
                                    </tr>
                                    <tr ng-show="selectedNode.data.misuse">
                                        <td>Misuse</td>
                                        <td>
                                            {{selectedNode.data.misuse}}

                                        </td>
                                    </tr>
                                    <tr ng-show="selectedNode.data.legacy">
                                        <td>Legacy issues</td>
                                        <td>
                                            {{selectedNode.data.legacy}}

                                        </td>
                                    </tr>

                                    <tr ng-show="selectedNode.data.mappingFromED.length > 0 && ! clinicalView"><td>Mappings</td><td>
                                        <table class="table table-condensed table-bordered"  style="margin-bottom: 2px">
                                            <tr><th>Identity</th><th>Map</th><th>Comment</th></tr>
                                            <tr ng-repeat="map in selectedNode.data.mappingFromED">
                                                <td>{{map.identity}}</td>
                                                <td>{{map.map}}</td>
                                                <td>{{map.comment}}</td>
                                            </tr>
                                        </table>

                                    </td></tr>





                                    <tr ng-show="selectedNode.data.fhirMappingExtensionUrl && ! clinicalView"><td>Extension Url</td>

                                        <td>
                                            <a href="#" ng-click="editExtension(selectedNode.data.fhirMappingExtensionUrl)">{{selectedNode.data.fhirMappingExtensionUrl}}</a>
                                        </td>

                                    </tr>

                                    <tr ng-show="selectedNode.data.comments"><td>Comments</td><td>{{selectedNode.data.comments}}</td></tr>

                                    <tr><td>Multiplicity</td><td>{{selectedNode.data.min}}..{{selectedNode.data.max}}</td></tr>

                                    <tr ng-show="selectedNode.data.analysis">
                                        <td>Extension data</td>
                                        <td>{{selectedNode.data.analysis | json}}</td>
                                    </tr>

                                    <tr><td>Datatypes</td>
                                        <td>
                                            <div ng-repeat = "typ in selectedNode.data.type">


                                                <div ng-hide = "typ.code == 'Reference'">


                                                    <a ng-hide="typ.code == 'Dosage'"
                                                       uib-popover="Will open a new tab with the description of this datatype"
                                                       popover-placement="top"
                                                       popover-trigger="'mouseenter'"
                                                       ng-href="{{rootForDataType}}{{typ.code}}" target="_blank">
                                                        <i class="glyphicon glyphicon-eye-open clickable"></i>
                                                    </a>


                                                    {{typ.code}}
                                                    <!--
                                                    <span class="clickable pull-right"
                                                          ng-click="viewDataType(typ.code)">View elements</span>
                                                    -->
                                                </div>


                                                <div ng-show = "typ.code == 'Reference'">
                                                    <div ng-repeat = 'targetProfile in typ.targetProfile'>
                                                    <span ng-show="isCoreType(targetProfile)">
                                                    <a ng-href="{{fhirRoot}}{{targetProfile | getLogicalID}}.html" target="_blank">


                                                        <i class="glyphicon glyphicon-eye-open clickable"></i>
                                                    </a>

                                                </span>


                                                        <span class="clickable pull-right" ng-click="viewReferencedModel(targetProfile)">View elements</span>
                                                        Reference -> {{targetProfile | getLogicalID}}
                                                    </div>


                                                </div>
                                            </div>

                                            <span ng-show="selectedNode.data.selectedValueSet">

                                         <span class="clickable" ng-click="viewVS(selectedNode.data.selectedValueSet.valueSet)">
                                            {{selectedNode.data.selectedValueSet.valueSet}}</span>
                                            ({{selectedNode.data.selectedValueSet.strength}})

                                    </span>


                                        </td>


                                    </tr>




                                    <tr ng-show="selectedNode.data.conceptMap">
                                        <td>ConceptMap</td>
                                        <td><a href="#" ng-click="showConceptMap(selectedNode.data.conceptMap)">{{selectedNode.data.conceptMap}}</a></td></tr>

                                    <tr ng-show="selectedNode.data.mapping"><td>Mapping notes</td><td>
                                        {{selectedNode.data.mapping}}


                                    </td></tr>
                                    <tr ng-show="selectedNode.data.fixedString">
                                        <td>Fixed</td><td>{{selectedNode.data.fixedString}}</td>
                                    </tr>


                                </table>

                            </div>
                        </div>

<!--
                        <div class="col-md-3">


                            <div class="list-group" style="margin-top: 16px">


                                <div class="list-group-item" ng-repeat="task in tasks track by $index"
                                     ng-if = "task.path==selectedNode.id || task.path==selectedNode.data.idFromSD">
                                    {{task.description}}
                                    <div><em class="pull-right"> {{task.requesterReference.display}}</em></div>

                                    <div ng-show="task.notes.length >0">
                                        <hr/>
                                        <div ng-repeat="note in task.notes">

                                            <div style="margin-left: 20px" >{{note.text}}</div>
                                            <div><em class="pull-right">{{note.authorString}}</em></div>
                                            <br/><br/>
                                        </div>

                                    </div>
                                    <div class="clearfix"></div>


                                </div>
                            </div>
                        </div>
                        -->
                    </div>
                </uib-tab>

                <uib-tab heading="Table view">
                    <br/>
                    <div class="pull-right">
                        <input type="checkbox" ng-model="input.mustSupportOnly"/> Show 'must support' only
                    </div>
                    <br/>
                    <table class="table table-bordered table-condensed">
                        <tr>

                            <th>Element</th><th>Must Support</th><th>DataType</th><th>Mult.</th><th>Description & Comments</th><th>Element Specific</th></tr>
                            <tr ng-class="{isModifierExtension:row.data.isModifierExtension}" ng-show="showTableElement(row)"
                            ng-repeat="row in treeData">

                            <td>

                                <div  ng-style="{ 'padding-left': (row.data.path | pathindent) }"
                                      ng-click="selectNodeFromTable(row.data.path)" >{{row.data.path| lastInPath}}</div>
                            </td>

                            <td>{{row.data.mustSupport}}</td>


                            <td>
                                <div ng-repeat="type in row.data.type">
                                    {{type.code}}
                                    <div ng-repeat="profile in type.targetProfile">
                                        <span class="reference">--> {{profile | referenceType}}</span>
                                    </div>



                                </div>

                                <div ng-show="row.data.isExtension && !row.data.isModifierExtension ">
                                    <div class="isExtension"
                                         uib-popover="{{row.data.fhirMappingExtensionUrl}}"
                                         popover-placement="top"
                                         popover-trigger="'mouseenter'">
                                        (Extension)
                                    </div>
                                </div>

                                <div ng-show="row.data.isModifierExtension">
                                    <div class="isModifierExtension"
                                         uib-popover="{{row.data.fhirMappingExtensionUrl}}"
                                         popover-placement="top"
                                         popover-trigger="'mouseenter'">
                                        (ModifierExtension)
                                    </div>
                                </div>

                            </td>

                            <td>{{row.data.min}}..{{row.data.max}}</td>
                            <td>
                                {{row.data.description}}
                                <div>{{row.data.ed.comment}}</div>
                                <div>{{row.data.usageGuide}}</div>

                            </td>
                            <td>
                                <div ng-show="row.data.selectedValueSet">
                                    <span class="clickable" ng-click="viewVS(row.data.selectedValueSet.valueSet)">
                                            {{row.data.selectedValueSet.valueSet}}</span>
                                    ({{row.data.selectedValueSet.strength}})
                                </div>



                            </td>
                        </tr>

                    </table>
                    <em>Summary data only. Elements marked as 'excluded' in the model are not shown here</em>

                </uib-tab>

                <uib-tab heading="ValueSets">

                    <div>
                        <a class="btn btn-link pull-right" download="{{vsDwnloadLinkJsonName}}"
                           href="{{vsDownloadLinkJsonContent}}" title="{{vsDwnloadLinkJsonName}}" >
                            Download CSV of full table
                        </a>
                    </div>

<!--
                    {{selectedArtifact.reference.reference}}
-->


                    <table class="table table-bordered">
                        <tr><th>Path
                            <span class="pull-right">
                                <i class="glyphicon glyphicon-question-sign"
                                   popover-class="plain"
                                   uib-popover="Where in the model the ValueSet is used. It can either be a core element or an extension."
                                   popover-trigger="'mouseenter'"
                                   popover-placement="right"></i>
                            </span>
                        </th><th>ValueSet Url

                            <span class="pull-right">
                                <i class="glyphicon glyphicon-question-sign"
                                   popover-class="plain"
                                   uib-popover="The ValueSet Url may not resolve. Regardless, it should be considered as a unique identifier"
                                   popover-trigger="'mouseenter'"
                                   popover-placement="right"></i>
                            </span>

                        </th><th>Description</th><th>Strength</th><th>CodeSystem Urls</th><th>Note</th></tr>
                        <tr ng-repeat="vs in analysis.valueSets"
                            ng-show="selectedArtifact.reference.reference == vs.modelUrl || input.showAllAnalysis">
                           <!-- <td>{{vs.url | referenceType}}</td> -->
                            <td>

                                {{vs.ed.path | dropFirstInPath}}</td>
                            <td>
                                         <span class="clickable" ng-click="viewVS(vs.valueSetUrl)">
                                            {{vs.valueSetUrl}}
                                         </span>
                            </td>
                            <td>{{vs.valueSet.description}}</td>
                            <td>{{vs.strength}}</td>
                            <td>
                                <div ng-repeat = "inc in vs.codeSystems">{{inc}}</div>
                            </td>
                            <td>{{vs.note}}</td>
                        </tr>
                    </table>

                </uib-tab>

                <uib-tab heading="Extensions" ng-hide="clinicalView">
                    <br/>
                    <table class="table table-bordered">
                        <tr><th>Path
                            <span class="pull-right">
                                <i class="glyphicon glyphicon-question-sign"
                                   popover-class="plain"
                                   uib-popover="Where in the model the extension is found. In a resource instance, it will be in an extension element."
                                   popover-trigger="'mouseenter'"
                                   popover-placement="right"></i>
                            </span>
                        </th><th>Elements</th>
                            <th>Extension Url
                            <span class="pull-right">
                                <i class="glyphicon glyphicon-question-sign"
                                   popover-class="plain"
                                   uib-popover="The extension definition does not yet resolve, but it will do so"
                                   popover-trigger="'mouseenter'"
                                   popover-placement="right"></i>
                            </span>

                        </th><th>Definition</th>
                        </tr>
                        <tr ng-repeat="ext in analysis.extensions"
                            ng-class="{isModifierBackground:ext.isModifier}"
                            ng-show="selectedArtifact.reference.reference == ext.url || input.showAllAnalysis">

                            <td><div>{{ext.ed.path | dropFirstInPath}}</div></td>
                            <td>
                                <table class="table table-bordered table-condensed">
                                    <tr ng-repeat = "ele in ext.elements">
                                        <td>{{ele.name}}</td>
                                        <td>{{ele.type}}</td>

                                    </tr>
                                </table>

                            </td>
                            <td>{{ext.extensionUrl}}</td>
                            <td>{{ext.ed.definition}}</td>

                        </tr>
                    </table>
                    <em>These are the extensions that have been defined for this resource. They represent new elements in the Logical Model, and are used by the profile.
                        lines in <span class="isModifierBackground">Red</span> are modifier extensions (ie their value can change the meaning of the resource
                        so must be understood by the client.
                        The information is derived from the Logical Model</em>
                    <!-- <pre>{{analysis.extensions | json}}</pre>-->
                </uib-tab>

                <uib-tab heading="Shorthand"  ng-hide="clinicalView">
                    <br/>
                    <p>
                        <a href="http://build.fhir.org/ig/HL7/fhir-shorthand" target="_blank">FHIR Shorthand</a> scripts that are used to generate the FHIR artifacts (like
                        StructureDefinitions) from the logical model show in the Tree and Table tabs. These are a work in progress
                        and may not all be completed.
                    </p>
                    <br/>
                    <uib-tabset>
                        <uib-tab heading="Profile">
                            <!--
                            <p ng-show="selectedArtifact.fsh">The FHIR shorthand definition that generated the formal profile for this model.
                                This indicates the difference from the core resource</p>
                            <p ng-hide="selectedArtifact.fsh">This will show the FHIR shorthand definition that generates the formal profile for this model.
                                This will show the difference from the core resource</p>
-->

                            <div hljs hljs-source="selectedArtifact.fsh">

                            </div>
                            <!--
                            <pre ng-show="selectedArtifact.fsh">{{selectedArtifact.fsh}}</pre>
                            -->
                        </uib-tab>
                        <uib-tab heading="Extensions">
                            <br/>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="list-group">
                                        <div ng-class="{'list-group-item':true,listItemSelected:ext.extensionUrl==input.selectedExtFSH.extensionUrl}"
                                             ng-repeat="ext in analysis.extensions"
                                             style="cursor: pointer"
                                            ng-show="selectedArtifact.reference.reference == ext.url || input.showAllAnalysis"
                                            ng-click="input.selectedExtFSH = ext">
                                            {{ext.ed.path | dropFirstInPath}}
                                        </div>
                                    </div>


                                </div>
                                <div class="col-md-9">
                                    <!--
                                    <pre>{{input.selectedExtFSH.fsh}}</pre>
                                    -->
                                    <div hljs hljs-source="input.selectedExtFSH.fsh">

                                    </div>

                                    <em>The 'XXX' suffixes on some elements are a temporary measure to resolve issues
                                    with the generation process. They will be removed.</em>
                                </div>
                            </div>



                        </uib-tab>
                    </uib-tabset>




                </uib-tab>

                <uib-tab heading="Profile"  ng-hide="clinicalView">
                    <br/>



                    <p ng-hide="selectedProfile">This will contain the formal profile for the resource that represents this model and will contain
                    a number of views of the profile. It will be generated by the FHIR IG publisher</p>

                    <div ng-show="selectedProfile">
                        <div class="pull-right" ng-show="selectedProfile">
                            <strong>Profile canonical Url: </strong> {{selectedProfile.url}}
                        </div>



                    </div>

                    <uib-tabset ng-show="selectedProfile">

                        <uib-tab heading="Profile header">
                            <pre>{{selectedProfileHeader | json}}</pre>
                            <i>Mapping, extensions and contact have been removed to save space</i>
                        </uib-tab>

                        <uib-tab heading="List of Elements">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="profileElementScroll">
                                        <div ng-repeat="element in selectedProfile.snapshot.element" ng-hide="element.max=='0'">
                                            <div ng-class="{clickable:true,selectedElement:element.id==selectedProfileElement.id}"



                                                 ng-click="selectProfileElement(element)">{{element.path}}</div>
                                        </div>
                                    </div>
                                    <em ng-show="selectedProfile">Elements with a max of 0 are not shown</em>
                                </div>
                                <div class="col-md-9" ng-show="selectedProfileElement">

                                    <pre>{{selectedProfileElement | json}}</pre>
                                    <i >Mapping and constraint elements have been removed to save space. </i>
                                </div>

                            </div>
                        </uib-tab>
                        <uib-tab heading="Json">
                            <pre>{{selectedProfile | json}}</pre>
                        </uib-tab>
                    </uib-tabset>







                </uib-tab>

                <uib-tab heading="Examples"  ng-hide="clinicalView">

                    <br/>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="list-group">
                                <div ng-class="{'list-group-item':true,listItemSelected:art.name == selectedArtifact.name}" ng-repeat="art in artifacts.example"
                                     style="cursor: pointer"
                                     ng-show="baseTypeForModel == art.baseType">
                                    <div ng-click="selectExample(art)">{{art.name}}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div ng-show="selectedExampleJson">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="rounded-box">
                                            <p ng-bind-html="selectedExampleJson.text.div"></p>

                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        {{appConfigSvc.getCurrentConformanceServer().url}}{{selectedArtifact.reference.reference}}
                                    </div>
                                </div>

                                <uib-tabset ng-show="selectedExampleJson">


                                    <uib-tab heading="Shorthand (wrapped)">
                                        <div hljs hljs-source="selectedArtifact.fsh">

                                        </div>


                                    </uib-tab>

                                    <uib-tab heading="Shorthand (scrolling)">
                                        <pre>{{selectedArtifact.fsh}}</pre>
                                    </uib-tab>


                                    <uib-tab heading="Json">
                                        <pre>{{selectedExampleJson | json}}</pre>
                                    </uib-tab>

                                    <uib-tab heading="Xml">
                                        <pre>{{selectedExampleXml}}</pre>
                                    </uib-tab>
                                    <uib-tab heading="Tree">
                                        <div class="pull-right">
                                            <button class="btn btn-link iconSpacing" ng-click="collapseAll()">Collapse all</button>
                                            <button class="btn btn-link iconSpacing" ng-click="expandAll()">Expand all</button>
                                        </div>
                                        <div id="exampleTree"></div>
                                    </uib-tab>

                                </uib-tabset>


                            </div>



                        </div>
                    </div>
                </uib-tab>

                <uib-tab heading="Server API / Search"  ng-hide="clinicalView">
                    <br/>

                    <div class="alert alert-info">
                        This represents the API that this resource type supports.
                    </div>
<!--
                    <div><strong>Profile:</strong> {{resourceDef[baseTypeForModel].profile}}</div>

                    -->
                    <div>
                        <p ng-bind-html="resourceDef[baseTypeForModel].documentation | markDown"></p>
                    </div>


                    <h4>Operations</h4>
                    <table class="table table-condensed table-bordered">
                        <tr><th>Code</th><th>Documentation</th></tr>
                        <tr ng-repeat="int in resourceDef[baseTypeForModel].interaction">
                            <td>{{int.code}}</td>

                            <td>{{int.documentation}}</td>

                        </tr>
                    </table>


                    <h4>Search Parameters</h4>

                    <table class="table table-condensed table-bordered">
                        <tr><th>Name</th><th>Type</th><th>Documentation</th><th>Definition (if custom)</th></tr>
                        <tr ng-repeat="sp in resourceDef[baseTypeForModel].searchParam">
                            <td>{{sp.name}}</td>
                            <td>{{sp.type}}</td>
                            <td>{{sp.documentation}}</td>
                            <td>{{sp.definition}}</td>
                        </tr>
                    </table>

                    <div ng-show="resourceDef[baseTypeForModel].searchInclude">
                        <h4>Includes</h4>
                        <table class="table table-condensed table-bordered">
                            <tr><th>Name</th></tr>
                            <tr ng-repeat="inc in resourceDef[baseTypeForModel].searchInclude">
                                <td>{{inc}}</td>

                            </tr>
                        </table>


                    </div>

                    <em>Derived from CapabilityStatement</em>
<!--
                    <pre>{{resourceDef[baseTypeForModel] | json}}</pre>
-->
                </uib-tab>




                <uib-tab heading="More Information" ng-show="selectedArtifact.moreInfo">


                    <div class="row">
                        <div class="col-md-2">
                            <div ng-class="{'list-group-item':true,'listItemSelected':mi1==mi}"
                                 style="cursor: pointer"
                                 ng-repeat="mi1 in selectedArtifact.moreInfo">
                                <div ng-click="selectMI(mi1)">
                                    <div>{{mi1.title}}</div>

                                </div>
                            </div>
                        </div>
                        <div class="col-md-10">
                            <div ng-show = "mi">
                                <iframe ng-src = "{{trustSrc(mi)}}"  width="100%" height = "600px"></iframe>
                            </div>

                        </div>
                    </div>
                </uib-tab>
            </uib-tabset>
        </div>


        <!--
                            <uib-tabset>
                                <uib-tab heading="Resources">

                                    <div ng-show="selectedGroup == 'valueset' && selectedResource">

                                        <div class="banner">ValueSet: {{selectedArtifact.name}}</div>
                                        <uib-tabset>


                                            <uib-tab heading="Description">
                                                <br/>

                                                <div class="row">
                                                    <div class="col-sm-6 col-md-6">
                                                        <div class="row">
                                                            <div class="col-sm-2 col-md-2">Name</div>
                                                            <div class="col-sm-10 col-md-10">{{selectedValueset.name}}</div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-2 col-md-2">Description</div>
                                                            <div class="col-sm-10 col-md-10">{{selectedValueset.description}}</div>
                                                        </div>
                                                        <div class="row" ng-show="selectedValueset.valueSet">
                                                            <div class="col-sm-2 col-md-2">ValueSet</div>
                                                            <div class="col-sm-10 col-md-10">{{selectedValueset.valueSet}}</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6 col-md-6">
                                                        <div class="row">
                                                            <div class="col-sm-2 col-md-2">Url</div>
                                                            <div class="col-sm-10 col-md-10">{{selectedValueset.url}}</div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-2 col-md-2">Publisher</div>
                                                            <div class="col-sm-10 col-md-10">{{selectedValueset.publisher}}</div>
                                                        </div>
                                                        <div class="row" ng-show="selectedValueset.content">
                                                            <div class="col-sm-2 col-md-2">Content</div>
                                                            <div class="col-sm-10 col-md-10">{{selectedValueset.content}}</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <br/>
                                                <a href="#" ng-show="selectedValueset.resourceType=='ValueSet'" class="clickableDotted"
                                                   ng-click="showValueSet(selectedValueset.url)">Explore ValueSet</a>



                                                <div ng-show="igGraphHash[selectedItem.url].usedBy">
                                                    <h5>Used By:
                                                        <ul class="list-unstyled">
                                                            <li ng-repeat="url in igGraphHash[selectedValueset.url].usedBy track by $index">
                                                                {{url}}
                                                            </li>
                                                        </ul>
                                                    </h5>

                                                </div>

                                                <br/> <br/>
                                                <div ng-show="valueSetOptions">
                                                    <h5>Options</h5>
                                                    <table class="table table-bordered">
                                                        <tr><th>Code</th><th>Display</th><th>System</th></tr>
                                                        <tr ng-repeat="option in valueSetOptions">
                                                            <td>{{option.code}}</td>
                                                            <td>{{option.display}}</td>
                                                            <td>{{option.system}}</td>
                                                        </tr>
                                                    </table>

                                                    <br/>
                                                </div>



                                                <div class="alert alert-error" ng-show="valueSetExpandError">
                                                    <h4>Errors expanding ValueSet</h4>
                                                    <table class="table">
                                                        <tr><th>Code</th><th>Severity</th><th>details</th><th>Diagnostics</th></tr>
                                                        <tr ng-repeat="iss in valueSetExpandError.issue">
                                                            <td>{{iss.code}}</td>
                                                            <td>{{iss.severity}}</td>
                                                            <td><pre ng-show="iss.details">{{iss.details}}</pre></td>
                                                            <td>{{iss.diagnostics}}</td>
                                                        </tr>
                                                    </table>



                                                </div>





                                            </uib-tab>


                                            <uib-tab heading="Json">
                                                <pre>{{selectedResource | json}}</pre>
                                            </uib-tab>
                                        </uib-tabset>

                                    </div>

                                    <div ng-show="selectedGroup == 'namingsystem' && selectedResource">

                                        <div class="banner">Naming System: {{selectedArtifact.name}}</div>
                                        <uib-tabset>
                                            <uib-tab heading="Details">
                                                <br/>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <strong>Description</strong>
                                                    </div>
                                                    <div class="col-md-5">
                                                        {{selectedResource.description}}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-1">

                                                    </div>
                                                    <div class="col-md-2">
                                                        ({{selectedResource.kind}})
                                                    </div>
                                                </div>
                                                <br/>


                                                <table class="table table-bordered">
                                                    <tr><th>Type</th><th>Value</th><th>Comment</th></tr>
                                                    <tr ng-repeat="id in selectedResource.uniqueId">
                                                        <td>{{id.type}}</td>
                                                        <td>{{id.value}}</td>
                                                        <td>{{id.comment}}</td>
                                                    </tr>
                                                </table>

                                            </uib-tab>

                                            <uib-tab heading="Json">
                                                <pre>{{selectedResource | json}}</pre>
                                            </uib-tab>


                                        </uib-tabset>



                                    </div>

                                    <div ng-show="selectedGroup == 'logical' && selectedResource">

                                        <div class="banner">Logical model: {{selectedResource.title}}</div>

                                        <uib-tabset ng-show="selectedArtifact">

                                            <uib-tab heading="Description">

                                                <div ng-hide="arDocs.length > 0" >
                                                    <br/>
                                                    <div class="row">
                                                        <div class="col-md-2">
                                                            Purpose
                                                        </div>
                                                        <div class="col-md-10">
                                                            <p ng-bind-html="selectedResource.purpose | markDown"></p>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-2">
                                                            Last updated
                                                        </div>
                                                        <div class="col-md-10">
                                                            {{selectedResource.meta.lastUpdated | date}}  {{selectedResource.meta.lastUpdated | getAgeSeconds:true}}
                                                        </div>
                                                    </div>

                                                    <div ng-show="selectedArtifact.profileForLM">
                                                        <div class="row">
                                                            <div class="col-md-2">
                                                                Profile
                                                            </div>
                                                            <div class="col-md-5">
                                                                {{appConfigSvc.getCurrentConformanceServer().url}}{{selectedArtifact.profileForLM}}
                                                            </div>
                                                            <div class="col-md-5">
                                                                <em>This is the location of the formal FHIR Profile for this Logical Model (ie, how an instance will be represented 'on the wire')</em>
                                                            </div>
                                                        </div>

                                                    </div>


                                                </div>

                                                <div class="doc" ng-repeat = "doc in arDocs">
                                                    <p ng-bind-html="doc.contents | markDown"></p>
                                                </div>



                                            </uib-tab>

                                            <uib-tab heading="Tree view">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="designerScroll" id="lmTreeView"></div>

                                                    </div>
                                                    <div class="col-md-6">
                                                        <div ng-show="selectedNode">
                                                            <div class="row">
                                                                <div class="col-md-8 col-sm-8">
                                                                    <h4>{{selectedNode.text}}</h4>

                                                                </div>
                                                                <div class="col-md-4 col-sm-4">
                                                                    <div class="pull-right">
                                                                        <input style="margin-top: 15px"
                                                                               ng-click="setClinicalView(clinicalView)"
                                                                               type = "checkbox" ng-model="clinicalView"/> Clinical View
                                                                    </div>

                                                                </div>
                                                            </div>

                                                            <table class="table table-bordered">

                                                                <tr>
                                                                    <td width="20%">Name</td>
                                                                    <td>{{selectedNode.data.name}}


                                                                    </td>
                                                                </tr>




                                                                <tr ng-show = "selectedNode.data.edStatus && (selectedNode.data.edStatus !== 'included')" class="required">
                                                                    <td>Status</td><td>{{selectedNode.data.edStatus}}

                                                                    <span class="pull-right"><em>{{statusDescription[selectedNode.data.edStatus]}}</em></span>


                                                                </td>
                                                                </tr>


                                                                <tr ng-show="selectedNode.data.lmReviewReason">
                                                                    <td>Reason for review</td>
                                                                    <td>
                                                                        {{selectedNode.data.lmReviewReason}}

                                                                    </td>
                                                                </tr>
                                                                <tr ng-show="selectedNode.data.alias">
                                                                    <td width="20%">Alias</td>
                                                                    <td>
                                                                        <ul>
                                                                            <li ng-repeat="al in selectedNode.data.alias track by $index">
                                                                                {{al}}
                                                                            </li>
                                                                        </ul>
                                                                    </td>
                                                                </tr>


                                                                <tr><td>Short</td><td>{{selectedNode.data.short}}</td></tr>
                                                                <tr><td>Description</td>
                                                                    <td>
                                                                        {{selectedNode.data.description}}

                                                                    </td>
                                                                </tr>





                                                                <tr ng-show="selectedNode.data.usageGuide">
                                                                    <td>Usage Guide</td>
                                                                    <td>
                                                                        {{selectedNode.data.usageGuide}}

                                                                    </td>
                                                                </tr>
                                                                <tr ng-show="selectedNode.data.misuse">
                                                                    <td>Misuse</td>
                                                                    <td>
                                                                        {{selectedNode.data.misuse}}

                                                                    </td>
                                                                </tr>
                                                                <tr ng-show="selectedNode.data.legacy">
                                                                    <td>Legacy issues</td>
                                                                    <td>
                                                                        {{selectedNode.data.legacy}}

                                                                    </td>
                                                                </tr>

                                                                <tr ng-show="selectedNode.data.mappingFromED.length > 0 && ! clinicalView"><td>Mappings</td><td>
                                                                    <table class="table table-condensed table-bordered"  style="margin-bottom: 2px">
                                                                        <tr><th>Identity</th><th>Map</th><th>Comment</th></tr>
                                                                        <tr ng-repeat="map in selectedNode.data.mappingFromED">
                                                                            <td>{{map.identity}}</td>
                                                                            <td>{{map.map}}</td>
                                                                            <td>{{map.comment}}</td>
                                                                        </tr>
                                                                    </table>

                                                                </td></tr>





                                                                <tr ng-show="selectedNode.data.fhirMappingExtensionUrl && ! clinicalView"><td>Extension Url</td>

                                                                    <td>
                                                                        <a href="#" ng-click="editExtension(selectedNode.data.fhirMappingExtensionUrl)">{{selectedNode.data.fhirMappingExtensionUrl}}</a>
                                                                    </td>

                                                                </tr>

                                                                <tr ng-show="selectedNode.data.comments"><td>Comments</td><td>{{selectedNode.data.comments}}</td></tr>

                                                                <tr><td>Multiplicity</td><td>{{selectedNode.data.min}}..{{selectedNode.data.max}}</td></tr>

                                                                <tr ng-show="selectedNode.data.analysis">
                                                                    <td>Extension data</td>
                                                                    <td>{{selectedNode.data.analysis | json}}</td>
                                                                </tr>

                                                                <tr><td>Datatypes</td>
                                                                    <td>
                                                                        <div ng-repeat = "typ in selectedNode.data.type">


                                                                            <div ng-hide = "typ.code == 'Reference'">


                                                                                <a ng-hide="typ.code == 'Dosage'" ng-href="{{rootForDataType}}{{typ.code}}" target="_blank">
                                                                                    <i class="glyphicon glyphicon-eye-open clickable"></i>
                                                                                </a>


                                                                                {{typ.code}}
                                                                                <span class="clickable pull-right"
                                                                                      ng-click="viewDataType(typ.code)">View elements</span>
                                                                            </div>


                                                                            <div ng-show = "typ.code == 'Reference'">
                                                                                <div ng-repeat = 'targetProfile in typ.targetProfile'>
                                                            <span ng-show="isCoreType(targetProfile)">
                                                            <a ng-href="{{fhirRoot}}{{targetProfile | getLogicalID}}.html" target="_blank">


                                                                <i class="glyphicon glyphicon-eye-open clickable"></i>
                                                            </a>

                                                        </span>


                                                                                    <span class="clickable pull-right" ng-click="viewReferencedModel(targetProfile)">View elements</span>
                                                                                    Reference -> {{targetProfile | getLogicalID}}
                                                                                </div>


                                                                            </div>
                                                                        </div>

                                                                        <span ng-show="selectedNode.data.selectedValueSet">

                                                 <span class="clickable" ng-click="viewVS(selectedNode.data.selectedValueSet.valueSet)">
                                                    {{selectedNode.data.selectedValueSet.valueSet}}</span>
                                                    ({{selectedNode.data.selectedValueSet.strength}})

                                            </span>


                                                                    </td>


                                                                </tr>




                                                                <tr ng-show="selectedNode.data.conceptMap">
                                                                    <td>ConceptMap</td>
                                                                    <td><a href="#" ng-click="showConceptMap(selectedNode.data.conceptMap)">{{selectedNode.data.conceptMap}}</a></td></tr>

                                                                <tr ng-show="selectedNode.data.mapping"><td>Mapping notes</td><td>
                                                                    {{selectedNode.data.mapping}}


                                                                </td></tr>
                                                                <tr ng-show="selectedNode.data.fixedString">
                                                                    <td>Fixed</td><td>{{selectedNode.data.fixedString}}</td>
                                                                </tr>


                                                            </table>

                                                        </div>
                                                    </div>


                                                    <div class="col-md-3">


                                                        <div class="list-group" style="margin-top: 16px">


                                                            <div class="list-group-item" ng-repeat="task in tasks track by $index"
                                                                 ng-if = "task.path==selectedNode.id || task.path==selectedNode.data.idFromSD">
                                                                {{task.description}}
                                                                <div><em class="pull-right"> {{task.requesterReference.display}}</em></div>

                                                                <div ng-show="task.notes.length >0">
                                                                    <hr/>
                                                                    <div ng-repeat="note in task.notes">

                                                                        <div style="margin-left: 20px" >{{note.text}}</div>
                                                                        <div><em class="pull-right">{{note.authorString}}</em></div>
                                                                        <br/><br/>
                                                                    </div>

                                                                </div>
                                                                <div class="clearfix"></div>


                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </uib-tab>



                                            <uib-tab heading="Table view">
                                                <br/>
                                                <table class="table table-bordered table-condensed">
                                                    <tr>

                                                        <th>Element</th><th>DataType</th><th>Mult.</th><th>Description & Comments</th><th>Element Specific</th></tr>
                                                    <tr  ng-show="showTableElement(row)" ng-repeat="row in treeData">

                                                        <td>

                                                            <div  ng-style="{ 'padding-left': (row.data.path | pathindent) }"
                                                                  ng-click="selectNodeFromTable(row.data.path)" >{{row.data.path| lastInPath}}</div>
                                                        </td>
                                                        <td>
                                                            <div ng-repeat="type in row.data.type">
                                                                {{type.code}}
                                                                <div ng-repeat="profile in type.targetProfile">
                                                                    <span class="reference">-> {{profile | referenceType}}</span>
                                                                </div>



                                                            </div>

                                                            <div ng-show="row.data.isExtension">
                                                                <div class="isExtension"
                                                                     uib-popover="{{row.data.fhirMappingExtensionUrl}}"
                                                                     popover-placement="top"
                                                                     popover-trigger="'mouseenter'">
                                                                    (Extension)
                                                                </div>
                                                            </div>

                                                        </td>

                                                        <td>{{row.data.min}}..{{row.data.max}}</td>
                                                        <td>
                                                            {{row.data.description}}
                                                            <div>{{row.data.ed.comment}}</div>
                                                            <div>{{row.data.usageGuide}}</div>

                                                        </td>
                                                        <td>
                                                            <div ng-show="row.data.selectedValueSet">
                                            <span class="clickable" ng-click="viewVS(row.data.selectedValueSet.valueSet)">
                                                    {{row.data.selectedValueSet.valueSet}}</span>
                                                                ({{row.data.selectedValueSet.strength}})
                                                            </div>



                                                        </td>
                                                    </tr>

                                                </table>
                                                <em>Summary data only. Elements marked as 'excluded' in the model are not shown here</em>

                                            </uib-tab>


                                            <uib-tab heading="Examples">

                                                <br/>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="list-group">
                                                            <div class="list-group-item" ng-repeat="art in artifacts.example"
                                                                 style="cursor: pointer"
                                                                 ng-show="baseTypeForModel == art.baseType">
                                                                <div ng-click="selectExample(art)">{{art.name}}</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-9">
                                                        <div ng-show="selectedExampleJson">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="rounded-box">
                                                                        <p ng-bind-html="selectedExampleJson.text.div"></p>

                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    {{appConfigSvc.getCurrentConformanceServer().url}}{{selectedArtifact.reference.reference}}
                                                                </div>
                                                            </div>

                                                            <uib-tabset ng-show="selectedExampleJson">
                                                                <uib-tab heading="Json">
                                                                    <pre>{{selectedExampleJson | json}}</pre>
                                                                </uib-tab>

                                                                <uib-tab heading="Xml">
                                                                    <pre>{{selectedExampleXml}}</pre>
                                                                </uib-tab>
                                                                <uib-tab heading="Tree">
                                                                    <div class="pull-right">
                                                                        <button class="btn btn-link iconSpacing" ng-click="collapseAll()">Collapse all</button>
                                                                        <button class="btn btn-link iconSpacing" ng-click="expandAll()">Expand all</button>
                                                                    </div>
                                                                    <div id="exampleTree"></div>
                                                                </uib-tab>

                                                            </uib-tabset>


                                                        </div>



                                                    </div>
                                                </div>






                                            </uib-tab>




                                            <uib-tab heading="More Information" ng-show="selectedArtifact.moreInfo">


                                                <div class="row">
                                                    <div class="col-md-2">
                                                        <div ng-class="{'list-group-item':true,'listItemSelected':mi1==mi}"
                                                             style="cursor: pointer"
                                                             ng-repeat="mi1 in selectedArtifact.moreInfo">
                                                            <div ng-click="selectMI(mi1)">
                                                                <div>{{mi1.title}}</div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-10">
                                                        <div ng-show = "mi">
                                                            <iframe ng-src = "{{trustSrc(mi)}}"  width="100%" height = "600px"></iframe>
                                                        </div>

                                                    </div>
                                                </div>
                                            </uib-tab>
                                        </uib-tabset>
                                    </div>


                                </uib-tab>
                                <uib-tab heading="IG Analysis">
                                    <button class="btn btn-link" ng-hide= "analysis" ng-click="analyse()">Perform analysis</button>


                                    <div class="pull-right"  ng-show="analysis">
                                        <input type="checkbox" ng-model="input.showAllAnalysis"/> Show all
                                    </div>
                                    <br/>
                                    <uib-tabset ng-show="analysis">
                                        <uib-tab heading="Extensions">
                                            <table class="table table-bordered">
                                                <tr><th>Model</th><th>Path</th><th>Extension Url</th><th>Definition</th></tr>
                                                <tr ng-repeat="ext in analysis.extensions"
                                                    ng-show="selectedArtifact.reference.reference == ext.url || input.showAllAnalysis">
                                                    <td>{{ext.url| referenceType}}</td>
                                                    <td>{{ext.ed.path | dropFirstInPath}}</td>
                                                    <td>{{ext.extensionUrl}}</td>
                                                    <td>{{ext.ed.definition}}</td>
                                                </tr>
                                            </table>
                                        </uib-tab>
                                        <uib-tab heading="ValueSets">

                                            <div>
                                                <a class="btn btn-link pull-right" download="{{vsDwnloadLinkJsonName}}"
                                                   href="{{vsDownloadLinkJsonContent}}" title="{{vsDwnloadLinkJsonName}}" >
                                                    Download CSV of full table
                                                </a>
                                            </div>

                                            <table class="table table-bordered">
                                                <tr><th>Model</th><th>Path</th><th>ValueSet Url</th><th>Description</th><th>Strength</th><th>CodeSystem Urls</th><th>Note</th></tr>
                                                <tr ng-repeat="vs in analysis.valueSets"
                                                    ng-show="selectedArtifact.reference.reference == vs.url || input.showAllAnalysis">
                                                    <td>{{vs.url | referenceType}}</td>
                                                    <td>{{vs.ed.path | dropFirstInPath}}</td>
                                                    <td>
                                                 <span class="clickable" ng-click="viewVS(vs.valueSetUrl)">
                                                    {{vs.valueSetUrl}}
                                                 </span>
                                                    </td>
                                                    <td>{{vs.valueSet.description}}</td>
                                                    <td>{{vs.strength}}</td>
                                                    <td>
                                                        <div ng-repeat = "inc in vs.codeSystems">{{inc}}</div>
                                                    </td>
                                                    <td>{{vs.note}}</td>
                                                </tr>
                                            </table>
                                        </uib-tab>
                                    </uib-tabset>





                                </uib-tab>
                            </uib-tabset>



        -->



    </div>
</div>

</div>