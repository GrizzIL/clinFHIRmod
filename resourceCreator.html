<!DOCTYPE html>
<html>
<head lang="en">
    <base href="/" />
    <meta charset="UTF-8">
    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>

    <script src="js/libs/ui-bootstrap-tpls-1.2.5.min.js"></script>
   <!--
   <script src="js/libs/angular.min.1.4.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-0.14.3.min.js"></script>
-->
    <link rel="stylesheet" type="text/css" href="css/jsTreeStyle.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsTreeThemes/proton/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>

    <script src="js/libs/angular-sanitize.js"></script>
    <script src="js/libs/toArrayFilter.js"></script>
    <script src="js/libs/jstree.min.js"></script>
    <script src="js/libs/moment.min.js"></script>
    <script src="/js/libs/angular-cookies.min.js"></script>
    <script src="js/libs/ngStorage.min.js"></script>
    <script src="js/libs/angular-translate.min.js"></script>


    <style>
        .applyPadding {
            padding-top: 80px;
        }
    </style>

    <script>
        //http://stackoverflow.com/questions/18214835/angularjs-how-to-enable-locationprovider-html5mode-with-deeplinking
        //http://www.ng-newsletter.com/posts/angular-translate.html
/*        angular.module("sampleApp",['ngCookies','ui.bootstrap','ngSanitize','angular-toArrayFilter','ngStorage','pascalprecht.translate']).config(
                ['$locationProvider', function( $locationProvider,$translateProvider) {

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');



        }]);
*/
        angular.module("sampleApp",['ngCookies','ui.bootstrap','ngSanitize','angular-toArrayFilter','ngStorage','pascalprecht.translate'])


        angular.module("sampleApp").config(function($locationProvider,$translateProvider){
            console.log($translateProvider)

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');

             $translateProvider.translations('en', {
             TITLE: 'Resource Creator',
             MYRECENTPATIENTS : 'My recent patients',
             MYRECENTPROFILES : 'My recent profiles',
             SYSTEMCONFIGURATION : 'System Configuration',
             PATIENT : 'Patient',
             PROFILE : 'Profile',
             'LANGUAGE.ENGLISH' : 'English',
             'LANGUAGE.RUSSIAN' : 'Russian',
             'LANGUAGE.DUTCH' : 'Dutch'
             });

            $translateProvider.translations('ru', {
                TITLE: 'Создатель ресурсов',
                MYRECENTPATIENTS : 'Мои недавние пациенты',
                MYRECENTPROFILES : 'Мои недавние профили',
                SYSTEMCONFIGURATION : 'Конфигурация системы',
                PATIENT : 'Пациент',
                PROFILE : 'Профиль',
                'LANGUAGE.ENGLISH' : 'английский',
                'LANGUAGE.RUSSIAN' : 'русский',
                'LANGUAGE.DUTCH' : 'Голландский'
            });

            $translateProvider.translations('du', {
                TITLE: 'schepper resource',
                MYRECENTPATIENTS : 'Mijn recente patiënten',
                MYRECENTPROFILES : 'Mijn recente profielen',
                SYSTEMCONFIGURATION : 'Systeem configuratie',
                PATIENT : 'Geduldig',
                PROFILE : 'Profiel',
                'LANGUAGE.ENGLISH' : 'Engels',
                'LANGUAGE.RUSSIAN' : 'Russisch',
                'LANGUAGE.DUTCH' : 'Nederlands'
            });

            $translateProvider.preferredLanguage('ru');

            console.log($translateProvider.translations())

        })
/*
        angular.module('sampleApp')
                .factory('$exceptionHandler', function () {
                    return function errorCatcherHandler(exception, cause) {
                        console.log('captured exception->', exception,cause);
                        //Raven.captureException(exception);
                    };
                });

        */


/*
        window.onerror = function (em, url, ln) {
            alert(em + ", " + url + ", " + ln);
            return false;
        }
*/

    </script>





    <!-- files needed for resourceCreator -->
    <script src="js/resourceCreatorCtrl.js"></script>
    <script src="js/resourceCreatorSvc.js"></script>

    <script src="js/appConfigSvc.js"></script>

    <script src="resourceBuilder/rbServices.js"></script>
    <script src="resourceBuilder/vsBrowser.js"></script>
    <script src="resourceBuilder/selectProfile.js"></script>
    <script src="js/services.js"></script>

    <script src="js/filters.js"></script>
    <script src="js/searchForResourceCtrl.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/menuCtrl.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <script src="js/components/profileDisplayComp.js"></script>

    <script src="js/components/resourceUploadComp.js"></script>

    <title>FHIR Resource Creator</title>

</head>


<body style="padding: 8px ">

    <div  ng-app="sampleApp" ng-controller="resourceCreatorCtrl" class="container-fluid">

        <div ng-class="{applyPadding : ! startupParams.hideNav}" >
        <!-- Hide the nav bar if the 'hideNav' query parameter is set in the call-->
            <nav ng-hide="startupParams.hideNav" class="navbar navbar-default navbar-fixed-top" role="navigation">

                <div class="container-fluid">
                    <div class="col-md-1">
                        <a class="navbar-brand" href="#">
                            <!--
                            Resource Creator
                            -->
                            {{ 'TITLE' | translate }}

                        </a>

                    </div>

                    <div class="col-md-5">
                        <p>


                            <div>

                                <span uib-dropdown  popover-placement="right" popover-trigger='mouseenter'
                                      uib-popover="Data Server: {{appConfigSvc.getCurrentDataServer().url}}">
                                    <strong>{{'PATIENT' | translate}}: </strong>

                                </span>

                                {{ResourceUtilsSvc.getOneLineSummaryOfResource(appConfigSvc.getCurrentPatient())}}
                                 ({{appConfigSvc.getCurrentPatient().id}})
                                <!--<a ng-show="appConfigSvc.getCurrentPatient()" href="#" ng-click="displayMode = 'patient'">Details</a> -->

                        <a ng-show="appConfigSvc.getCurrentPatient()" href="#" ng-click="displayMode = 'view'">Details</a>

                            </div>

                        <div>
                                <span uib-dropdown  popover-placement="right" popover-trigger='mouseenter'
                                      uib-popover="Conformance Server: {{appConfigSvc.getCurrentConformanceServer().url}}">
                                        <strong>{{'PROFILE'|translate}}:</strong>
                                </span>

                            {{resourceCreatorSvc.getCurrentProfile().url}}
                        </div>

                        </p>


                    </div>


                    <div class="col-md-6">

                        <div class="navbar-text">


                            <span uib-dropdown ng-hide="resourceCreatorSvc.getParkedResources().length==0">
                                  <a href  uib-dropdown-toggle>
                                      Parked <span class="badge">{{resourceCreatorSvc.getParkedResources().length }}</span>
                                  </a>
                                  <ul uib-dropdown-menu aria-labelledby="simple-dropdown">
                                      <li ng-repeat="park in resourceCreatorSvc.getParkedResources()">
                                          <a href = '#' ng-click="restoreFromParked(park,$index)">{{park.display}}</a>
                                      </li>
                                  </ul>
                             </span>


                        </div>







                        <form ng-show="displayMode == 'new'" class="navbar-form navbar-right">



                            <button class="btn btn-danger pull-right" ng-show="buildState=='dirty'"
                                    ng-click="cancelNewResource('dirty')">Cancel</button>

                            <button class="btn btn-success pull-right" ng-hide="buildState=='dirty'"
                                    ng-click="cancelNewResource('close')">Close</button>

                            <!--
                            <button class="btn btn-danger pull-right" ng-click="cancelNewResource()">

                                <div ng-show="buildState=='dirty'">Cancel</div>
                                <div ng-hide="buildState=='dirty'">Close</div>





                            </button>
                            -->
                        </form>

                        <form ng-show="displayMode == 'new'" class="navbar-form navbar-right">
                            <button class="btn btn-primary pull-right" ng-click="saveToServer()">Save</button>
                            <button style="margin-right: 8px" class="btn btn-info pull-right" ng-click="park()">Park</button>

                            <button
                                    popover-placement="left" popover-trigger='mouseenter'
                                    uib-popover="Validate against Data Server:{{config.servers.data}}"
                                    class="btn btn-link pull-right" ng-click="validate()">Validate</button>
                        </form>


                        <!-- The menu-->
                        <div ng-controller="menuCtrl" ng-show="displayMode == 'front'">

                            <!--
                            a convenience link during dev
                            <a class="navbar-form navbar-right" href="#" ng-click="showQuery()">Query Servers</a>
-->

                            <ul class="nav navbar-nav navbar-right"  ng-hide="waiting">
                                <li uib-dropdown>

                                    <a href="#" uib-dropdown-toggle>
                                    <span style="font-size:2em; cursor: pointer">
                                        <i class="glyphicon glyphicon-cog"></i>
                                    </span>
                                    </a>

                                    <ul class="dropdown-menu" role="menu">
                                        <li>
                                            <a href="#" ng-click="showQuery()">Query Servers</a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#" ng-click="resetConfig()">Reset Config</a>
                                        </li>
                                        <li>
                                            <a href="#" ng-click="clearProfileCache()">Clear Profiles Cache</a>
                                        </li>
                                        <li>
                                            <a href="#" ng-click="clearPatientCache()">Clear Patient Cache</a>
                                        </li>
                                        <li class="divider"></li>

                                        <li>
                                            <a href="#" ng-click="changeLanguage()">Change Language</a>
                                        </li>

                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <form ng-hide="displayMode == 'new' || displayMode == 'query' " class="navbar-form navbar-right">
                            <div ng-show="appConfigSvc.getCurrentPatient() && resourceCreatorSvc.getCurrentProfile()">
                                <button class="btn btn-info pull-right" ng-click="createNewResource()">New Resource</button>
                            </div>
                        </form>

                        <!-- <form ng-hide="displayMode == 'new' || displayMode == 'query' " class="navbar-form navbar-right">
                            <div ng-show="appConfigSvc.getCurrentPatient() && resourceCreatorSvc.getCurrentProfile()">
                                <button class="btn btn-info pull-right" ng-click="displayMode = 'new'">New Resource</button>
                            </div>
                        </form> -->


                        <form ng-hide="displayMode == 'front' || displayMode == 'new'" class="navbar-form navbar-right">
                            <span class="navbar-text" popover-placement="left" popover-trigger='mouseenter'
                                  uib-popover="Load front screen">
                                    <a href="#" ng-click="displayMode = 'front'">Front</a>
                                </span>
                        </form>

                        <div class="pull-right navbar-form" ng-show="waiting">
                            <img src="css/ajax_loader_blue_32.gif"/>
                        </div>


                    </div>

                </div>




            </nav>





            <div ng-show="displayMode == 'front'" ng-controller="frontCtrl">
                <ng-include src="'/includes/frontPage.html'"></ng-include>
            </div>


            <div ng-show="displayMode == 'query'" ng-controller="queryCtrl">
                <ng-include src="'/includes/serverQuery.html'"></ng-include>
            </div>



            <div ng-show="displayMode == 'new'">
                <ng-include src="'/includes/resourceCreatorMain.html'" onload="includeLoaded()"></ng-include>
            </div>


            <div ng-show="displayMode == 'view'">
                <ng-include src="'/includes/resourceViewer.html'"></ng-include>
            </div>

<!-- just for testing!-->






            <!-- a component (1.5) todisplay a profile-->
<!--
            <div class="row">
                <div class="col-md-1">
                </div>
                <div class="col-md-6">
                    <show-profile profile="selectedProfileForDisplay" onvaluesetselected="testVsSel(uri)"></show-profile>
                </div>
            </div>

-->

            <!-- a directive that allows a profile to be selected - not just a base one... -->
           <!-- <select-profile trigger="showFindProfileDialog"
                            all-resource-types="dynamic.resourcetypes"
                            profile-selected="selectedProfileFromDialog" type="'profile'">

            </select-profile>
-->

            <!-- A directive for browsing value sets-->
            <vs-browser trigger="showVSBrowserDialog"></vs-browser>

        </div>
    </div>

</body>
</html>