<!DOCTYPE html>
<html>
<head lang="en">
    <base href="/" />
    <meta charset="UTF-8">
    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>

    <script src="js/libs/ui-bootstrap-tpls-1.2.5.min.js"></script>
   <!--
   <script src="js/libs/angular.min.1.4.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-0.14.3.min.js"></script>
-->
    <link rel="stylesheet" type="text/css" href="css/jsTreeStyle.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsTreeThemes/proton/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>

    <script src="js/libs/angular-sanitize.js"></script>
    <script src="js/libs/toArrayFilter.js"></script>
    <script src="js/libs/jstree.min.js"></script>
    <script src="js/libs/moment.min.js"></script>
    <script src="/js/libs/angular-cookies.min.js"></script>
    <script src="js/libs/ngStorage.min.js"></script>


    <script>
        //http://stackoverflow.com/questions/18214835/angularjs-how-to-enable-locationprovider-html5mode-with-deeplinking
        angular.module("sampleApp",['ngCookies','ui.bootstrap','ngSanitize','angular-toArrayFilter','ngStorage']).config(
                ['$locationProvider', function( $locationProvider) {

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');

        }]);

    </script>





    <!-- files needed for resourceCreator -->
    <script src="js/resourceCreatorCtrl.js"></script>
    <script src="js/resourceCreatorSvc.js"></script>

    <script src="js/appConfigSvc.js"></script>

    <script src="resourceBuilder/rbServices.js"></script>
    <script src="resourceBuilder/vsBrowser.js"></script>
    <script src="resourceBuilder/selectProfile.js"></script>
    <script src="js/services.js"></script>

    <script src="js/filters.js"></script>
    <script src="js/searchForResourceCtrl.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/menuCtrl.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <title>FHIR Resource Creator</title>

</head>


<body style="padding: 8px;padding-top: 80px; ">

    <div ng-app="sampleApp" ng-controller="resourceCreatorCtrl" class="container-fluid">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">

            <div class="container-fluid">
                <div class="col-md-1">
                    <a class="navbar-brand" href="#">Resource Creator</a>

                </div>

                <div class="col-md-5">
                    <p>


                        <div>

                            <span uib-dropdown  popover-placement="right" popover-trigger='mouseenter'
                                  uib-popover="Data Server: {{appConfigSvc.getCurrentDataServer().url}}">
                                <strong>Patient: </strong>

                            </span>

                            {{ResourceUtilsSvc.getOneLineSummaryOfResource(appConfigSvc.getCurrentPatient())}}
                            <!--<a ng-show="appConfigSvc.getCurrentPatient()" href="#" ng-click="displayMode = 'patient'">Details</a> -->

                    <a ng-show="appConfigSvc.getCurrentPatient()" href="#" ng-click="displayMode = 'view'">Details</a>

                        </div>

                    <div>
                            <span uib-dropdown  popover-placement="right" popover-trigger='mouseenter'
                                  uib-popover="Conformance Server: {{appConfigSvc.getCurrentConformanceServer().url}}">
                                    <strong>Profile:</strong>
                            </span>

                        {{resourceCreatorSvc.getCurrentProfile().url}}
                    </div>

                    </p>


                </div>


                <div class="col-md-6">

                    <div class="navbar-text">


                        <span uib-dropdown ng-hide="resourceCreatorSvc.getParkedResources().length==0">
                              <a href  uib-dropdown-toggle>
                                  Parked <span class="badge">{{resourceCreatorSvc.getParkedResources().length }}</span>
                              </a>
                              <ul uib-dropdown-menu aria-labelledby="simple-dropdown">
                                  <li ng-repeat="park in resourceCreatorSvc.getParkedResources()">
                                      <a href = '#' ng-click="restoreFromParked(park,$index)">{{park.display}}</a>
                                  </li>
                              </ul>
                         </span>


                    </div>




                    <div ng-hide="displayMode == 'front'">
                        <span class="navbar-text" uib-dropdown  popover-placement="left" popover-trigger='mouseenter'
                              uib-popover="Front screen">
                                <a href="#" ng-click="displayMode = 'front'">Front</a>
                            </span>
                    </div>


                    <form ng-show="displayMode == 'new'" class="navbar-form navbar-right">
                        <button class="btn btn-danger pull-right" ng-click="cancelNewResource()">
                            Cancel
                        </button>
                    </form>

                    <form ng-show="displayMode == 'new'" class="navbar-form navbar-right">
                        <button class="btn btn-primary pull-right" ng-click="saveToServer()">Save</button>
                        <button style="margin-right: 8px" class="btn btn-info pull-right" ng-click="park()">Park</button>
                        <button class="btn btn-link pull-right" ng-click="validate()">Validate</button>
                    </form>


                    <!-- The menu-->
                    <div ng-controller="menuCtrl" ng-show="displayMode == 'front'">
                        <ul class="nav navbar-nav navbar-right"  ng-hide="waiting">
                            <li uib-dropdown>

                                <a href="#" uib-dropdown-toggle>
                                <span style="font-size:2em; cursor: pointer">
                                    <i class="glyphicon glyphicon-cog"></i>
                                </span>
                                </a>

                                <ul class="dropdown-menu" role="menu">
                                    <li>
                                        <a href="#" ng-click="showQuery()">Query Servers</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a href="#" ng-click="resetConfig()">Reset Config</a>
                                    </li>

                                </ul>
                            </li>
                        </ul>
                    </div>




                    <form ng-hide="displayMode == 'new'" class="navbar-form navbar-right">
                        <div ng-show="appConfigSvc.getCurrentPatient() && resourceCreatorSvc.getCurrentProfile()">
                            <button class="btn btn-info pull-right" ng-click="displayMode = 'new'">New Resource</button>

                        </div>
                    </form>



                    <div class="pull-right navbar-form" ng-show="waiting">
                        <img src="css/ajax_loader_blue_32.gif"/>
                    </div>


                </div>

            </div>




        </nav>



        <div ng-show="displayMode == 'front'" ng-controller="frontCtrl">
            <ng-include src="'/includes/frontPage.html'"></ng-include>
        </div>


        <div ng-show="displayMode == 'query'" ng-controller="queryCtrl">
            <ng-include src="'/includes/serverQuery.html'"></ng-include>
        </div>



        <div ng-show="displayMode == 'new'">
            <ng-include src="'/includes/resourceCreatorMain.html'" onload="includeLoaded()"></ng-include>
        </div>


        <div ng-show="displayMode == 'view'">
            <ng-include src="'/includes/resourceViewer.html'"></ng-include>
        </div>



        <!-- a directive that allows a profile to be selected - not just a base one... -->
        <select-profile trigger="showFindProfileDialog"
                        all-resource-types="dynamic.resourcetypes"
                        profile-selected="selectedProfile" type="'profile'">

        </select-profile>


        <!-- A directive for browsing value sets-->
        <vs-browser trigger="showVSBrowserDialog"></vs-browser>


    </div>

</body>
</html>