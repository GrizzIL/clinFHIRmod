<!DOCTYPE html>
<html>
<head lang="en">
    <base href="/" />
    <meta charset="UTF-8">
    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-2.0.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>
    <script src="js/libs/lodash.core.js"></script>

    <script src="js/libs/moment.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>

    <link rel="stylesheet" type="text/css" href="css/jsTreeStyle.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsTreeThemes/proton/style.css"/>

    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>

    <script src="js/libs/angular-sanitize.js"></script>
    <script src="js/libs/firebase.js"></script>
    <script src="js/libs/angularfire.min.js"></script>


    <script>
        angular.module("sampleApp",['ui.bootstrap','ngStorage','ui.checkbox',"firebase","ngSanitize"]).
        config(function($locationProvider) {

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');
        });

        angular.module("sampleApp").config(['$compileProvider', function ($compileProvider) {
            $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/);
            //$compileProvider.aHrefSanitizationWhitelist(/^\s*(|blob|):/);
        }]);

        angular.module("sampleApp").constant("moment", moment);

        window.onerror = function(message, url, linenumber) {
            if (message.indexOf('QuotaExceededError') > -1) {
                alert("It looks as if you've run out of cache memory. Use the Clear Cache option on the NavBar to clear it.")
            } else {
                alert("An unexpected error occurred: " + message + " on line " + linenumber + " for " + url);
            }
        }

    </script>

    <script src="js/appConfigSvc.js"></script>
    <script src="js/libs/ngStorage.min.js"></script>
    <script src="js/libs/jstree.min.js"></script>
    <script src="js/profileDiffCtl.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <script src="js/resourceCreatorSvc.js"></script>
    <script src="resourceBuilder/rbServices.js"></script>

    <script src="js/profileCreatorSvc.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/builderSvc.js"></script>
    <script src="js/services.js"></script>
    <script src="js/filters.js"></script>

    <script src="js/profileDiffSvc.js"></script>
    <script src="js/logicalModelSvc.js"></script>
    <script src="js/modellerFilters.js"></script>
    <script src="resourceBuilder/vsBrowser.js"></script>
    <script src="resourceBuilder/rbServices.js"></script>
    <script src="directive/profiletable/profileTable.js"></script>

    <script src="js/libs/vis.min.js"></script>
    <script src="js/components/extensionDirective.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/libs/angular-bootstrap-checkbox.js"></script>
    <script src="js/uploadCtrl.js"></script>

    <script src="js/loginSmileCtrl.js"></script>
    <script src="js/loginCtrl.js"></script>

    <script src="js/libs/showdown.min.js"></script>
    <script>

        var config = {
            apiKey: "AIzaSyBNMohLbPiSKwpGwfARopdeW_6LLXujcUo",
            authDomain: "clinfhir.firebaseapp.com",
            databaseURL: "https://clinfhir.firebaseio.com",
            storageBucket: ""
        };

        if (firebase) {
            firebase.initializeApp(config);
        }

    </script>

    <style>


        h1.md {
            font-size: 25px;
        }

        h2.md {
            font-size: 20px;
        }

        h3.md {
            font-size: 16px;
        }

        h3 {
            font-size: 16px;
        }


        #mmLogicalModel {
            width: 100%;
            height: 800px;
            border: 1px solid lightgray;
        }

        .myScroll {
            height: 800px;
            overflow-y: scroll;
        }
        .myRequiredDEP {
            color:red;
            background-color:  mistyrose;
        }
        .extensionDEP {
            color:blue;
            background-color: powderblue;
        }
        .borderTopDEP {
            border-top: 2pt solid black
        }

        .commentDEP {
            background-color: white;
            margin: 8px;
            border:8px
        }


        .presentDEP {
            color:green;
        }

        .absentDEP {
            color:red;
        }

    </style>
        <title>IG Viewer</title>

</head>


<body style="padding: 8px;padding-top: 100px" >

<div ng-app="sampleApp" ng-controller="profileDiffCtrl" class="container-fluid">

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">

        <div class="container-fluid">
            <div class="col-md-2 col-sm-2">
                <a class="navbar-brand" href="#">
                    clinFHIR Implementation Guide Viewer
                </a>
            </div>

            <div class="col-md-3 col-sm-3">
                <div class="navbar-text">
                    <div uib-popover="{{appConfigSvc.getCurrentDataServer().url}}"
                         popover-placement="right"
                         popover-trigger="'mouseenter'">Data:{{appConfigSvc.getCurrentDataServer().name}}</div>
                    <div uib-popover="{{appConfigSvc.getCurrentConformanceServer().url}}"
                         popover-placement="right"
                         popover-trigger="'mouseenter'">
                        Conformance:{{appConfigSvc.getCurrentConformanceServer().name}}</div>
                    <div uib-popover="{{appConfigSvc.getCurrentTerminologyServer().url}}"
                         popover-placement="right"
                         popover-trigger="'mouseenter'">Terminology:{{appConfigSvc.getCurrentTerminologyServer().name}}</div>

                </div>
            </div>

            <div class="col-md-1 col-sm-1">

                <form class="navbar-form navbar-left">
                    <img ng-show="waiting" src="css/ajax_loader_blue_32.gif"/>
                </form>
            </div>

            <div class="col-md-2 col-sm-2">

                <div ng-show="displayMessage">
                    <div class="alert alert-info">
                        {{displayMessage}}
                    </div>
                </div>


                <form ng-show="currentIG && !loadedFromBookmark && selectedItemType=='profile'" class="navbar-form">
                    <div class="navbar-text">
                        Full display <checkbox ng-model="input.displayMode" ng-change="changeMode(input.displayMode)"></checkbox>
                    </div>

                </form>
            </div>

            <div class="col-md-2 col-sm-2">
                <div class="navbar-text">
                    <div><a href="#" ng-click="clearCache()">Clear Cache</a></div>
                    <div><a href="#" ng-show="currentIG" ng-click="generateShortCut()">Create shortcut</a></div>

                </div>




            </div>

            <div class="col-md-1 col-sm-1">
                <div class="nav navbar-form navbar-right" ng-hide="currentUser">
                    <span style="font-size:1.8em; cursor: pointer"uib-popover="Click to log in"
                          popover-placement="left"
                          popover-trigger="'mouseenter'">
                        <div ng-click="login()">
                            <i class="glyphicon glyphicon-log-in"></i>
                        </div>
                    </span>
                </div>

                <div class="nav navbar-form navbar-right" ng-show="currentUser">
                    <span style="font-size:1.8em; cursor: pointer"
                          uib-popover="Current user: {{currentUser.displayName}}. Click to log out"
                          popover-placement="left"
                          popover-trigger="'mouseenter'">

                        <div href="#" ng-click="logout()"> <i class="glyphicon glyphicon-log-out"></i></div>
                    </span>
                </div>
            </div>


            <div class="col-md-1 col-sm-1">
                <ul class="nav navbar-nav navbar-right"  ng-hide="waiting">
                    <li uib-dropdown>

                        <a href="#" uib-dropdown-toggle>
                        <span style="font-size:2em; cursor: pointer">
                            <i class="glyphicon glyphicon-cog"></i>
                        </span>
                        </a>



                        <ul class="dropdown-menu" role="menu">



<!--
                            <li>
                                <a href="#" ng-click="generateShortCut()"
                                   uib-popover="Create a link for others to view this IG"
                                   popover-placement="left"
                                   popover-trigger="'mouseenter'">Share</a>
                            </li>
-->
                            <li>
                                <a href="#" ng-click="createDownload()"
                                   uib-popover="Download this IG"
                                   popover-placement="left"
                                   popover-trigger="'mouseenter'">Download</a>
                            </li>

                            <li>
                                <a href="#" ng-click="addIG()"
                                   uib-popover="Create a new IG"
                                   popover-placement="left"
                                   popover-trigger="'mouseenter'">New IG</a>
                            </li>


                        </ul>
                    </li>
                </ul>
            </div>

        </div>
    </nav>

    <span class="pull-left" ng-show="input.tabShowing=='comp'">

         <select class="form-control" ng-model="input.compareResourceType"
                 ng-change="loadCompProfiles('Left')"
                 ng-options="typ.name for typ in allResourceTypes">
        </select>
    </span>

    <div>

        <!-- This is the IG selector...-->
        <div class="row" ng-hide="loadedFromBookmark">
            <div class="col-sm-4 col-md-4">
            </div>
            <div class="col-sm-3 col-md-3">
                <select class="form-control" ng-model="input.selIG"
                        ng-options="ig.name for ig in listOfIG">

                </select>
            </div>
            <div class="col-sm-1 col-md-1">
                <button class="btn btn-success pull-right" ng-click="selectIG(input.selIG)">Load</button>
            </div>
        </div>


        <div>
            <div class="pull-right rounded-box"><strong>{{currentIG.name}}</strong></div>
        </div>

        <uib-tabset ng-show="currentIG">

            <uib-tab heading="Contents" >
                <div class="row">

                    <div class="col-md-3 col-sm-3">
                        <div ng-show="selectedItemType=='page' || selectedItemType=='pageRoot'" class="pull-right" style="margin-top: 8px">

                            <span ng-show="selectedPageNode && currentUser && currentUser.email=='david.hay25@gmail.com'">
                                <i class="glyphicon glyphicon-edit clickable iconSpacing"
                                   ng-click="addPage(selectedPageNode)"></i>
                                <i class="glyphicon glyphicon-remove clickable iconSpacing"
                                   ng-click="deletePage(selectedPageNode)"></i>
                                <i class="glyphicon glyphicon-arrow-down clickable iconSpacing"
                                   ng-click="move(selectedPageNode,'dn')"></i>
                                <i class="glyphicon glyphicon-arrow-up clickable iconSpacing"
                                   ng-click="move(selectedPageNode,'up')"></i>
                                <i class="glyphicon glyphicon-plus clickable iconSpacing"
                                   ng-click="addPage()"></i>
                            </span>



                            <hr style="margin-top: 30px"/>

                            <div>
                                <button class="btn btn-link pull-right" ng-show="pageDirty"
                                        ng-click="savePages()">Save</button>
                            </div>


                        </div>
                        <div id="pagesTreeView"></div>
                    </div>

                    <div class="col-md-9 col-sm-9">

                        <div ng-show="selectedItemType == 'pageRoot'">

                            <uib-tabset>
                                <uib-tab heading="Instructions">
                                    <ng-include src="'/includes/pageRoot.html'"></ng-include>
                                </uib-tab>
                                <uib-tab heading="Full content">
                                    <button class="btn btn-link" ng-click="createFullDoc()">Refresh</button>
                                    <div ng-show="loadingFullDoc">
                                        Loading all snippets, please wait...
                                    </div>
                                    <p ng-bind-html="fullDoc | markDown"></p>
                                </uib-tab>
                            </uib-tabset>







                        </div>

                        <div ng-show="selectedItemType == 'artifactRoot'">
                            <ng-include src="'/includes/artifactRoot.html'"></ng-include>
                        </div>

                        <div ng-show="selectedItemType == 'artifactType'">
                            <div class="row">
                                <div class="col-md-6">
                                    <h4>{{typeDescription[selectedArtifactType]}}s</h4>
                                </div>
                                <div class="col-md-6">
                                    <div class="pull-right">
                                        <div ng-show='canEdit' style="padding-top: 10px">
                                            <a href="#" ng-click="importItem({type:selectedArtifactType,
                                        display:typeDescription[selectedArtifactType]})">Attach new {{typeDescription[selectedArtifactType]}}</a>
                                        </div>

                                    </div>
                                </div>
                            </div>


                            <table class="table table-bordered table-condensed">
                                <tr><th>Name</th><th>Description</th><th>Url</th><th></th></tr>
                                <tr ng-repeat="item in artifacts[selectedArtifactType]">
                                    <td>{{item.name}}</td>
                                    <td>{{item.description}}</td>
                                    <td>{{item.url}}</td>
                                    <td>
                                        <div ng-show="canEdit">
                                            <i class="glyphicon glyphicon-edit clickable iconSpacing"
                                               ng-click="editResourceItem(item)"></i>
                                            <div class="pull-right" >
                                                <i class="glyphicon glyphicon-remove clickable iconSpacing"
                                                   ng-click="deleteResourceItem(item)"></i>
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                            </table>


                            <div ng-show="typeDescription[selectedArtifactType] == 'ValueSet' ||
                                typeDescription[selectedArtifactType] == 'CodeSystem' ||
                                typeDescription[selectedArtifactType] == 'Profile' ||
                                typeDescription[selectedArtifactType] == 'Extension Definition'">
                                <button class="btn btn-link pull-right" ng-click="validateArtifactsOnServer(typeDescription[selectedArtifactType])">Check that {{typeDescription[selectedArtifactType]}}s are present on the Terminology server</button>
                            </div>

                            <!-- DONT DELETE - just not supporting it now...
                            <div ng-show="typeDescription[selectedArtifactType] == 'ValueSet'">
                                <div class="clearfix"></div>
                                <button class="btn btn-link pull-right"
                                        ng-click="checkAllVSinIG()">Check that all ValueSets referenced by all profiles are present in the IG</button>
                            </div>
-->

                            <div ng-show="artifactChecks">
                                <table class="table table-bordered">
                                    <tr><th>Url</th><th>Present</th></tr>
                                    <tr ng-repeat="row in artifactChecks" ng-class="{absent:row.absent,present:row.present}">
                                        <td>{{row.url}}</td>
                                        <td>{{row.outcome}}</td>
                                    </tr>
                                </table>
                            </div>



                            <div ng-show = "hashVS">
                                <h4>ValueSets referenced in a profile or extension definition that are not listed in the IG</h4>
                                <table class="table table-bordered">

                                    <tr ng-repeat="(k,v) in hashVS" ng-show="v=='absent'">
                                        <td>{{k}}</td>
                                        <td>{{v}}</td>

                                    </tr>
                                </table>
                            </div>






                        </div>

                        <div ng-show="selectedItemType == 'page'">

                            <div ng-hide="selectedPageIsExternalUrl">

                                <uib-tabset>
                                    <uib-tab heading="Contents">
                                        <p ng-bind-html="input.selectedPageContents | markDown"></p>
                                    </uib-tab>
                                    <uib-tab ng-show="currentUser.email=='david.hay25@gmail.com'" heading="Edit">
                                        <div>
                                            Url: {{selectedPageNode.data.nameUrl}}
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <textarea ng-model = "input.selectedPageContents"
                                                          ng-blur="saveBinary(selectedPageNode.data,input.selectedPageContents)"
                                                          rows="20" class="form-control"></textarea>

                                            </div>
                                            <div class="col-md-6">
                                                <p ng-bind-html="input.selectedPageContents | markDown"></p>


                                            </div>

                                        </div>

                                    </uib-tab>

                                </uib-tabset>


                            </div>

                            <div ng-show="selectedPageIsExternalUrl">
                                <div>
                                    Url: {{selectedPageNode.data.source}}
                                </div>
                                <iframe height = "600px" width="100%" ng-src="{{page.src}}"></iframe>
                            </div>
                        </div>

                        <!--<div class="row" ng-hide="selectedItemType == 'page' || selectedItemType == 'artifactType'">-->
                        <div class="row" ng-show="selectedItem">
                            <div class="col-md-10">
                                <div><strong>{{selectedItem.name}}</strong></div>
                                {{selectedItem.description}}
                            </div>
                            <div class="col-md-2">
                                <div class="pull-right">
                                    <i class="glyphicon glyphicon-edit clickable iconSpacing"
                                       ng-click="editResourceItem(selectedItem)"></i>
                                </div>

                                <div class="pull-right">
                                    <i class="glyphicon glyphicon-remove clickable iconSpacing"
                                       ng-click="deleteResourceItem(selectedItem)"></i>
                                </div>


                            </div>
                        </div>

                        <div ng-show="selectedItemType == 'other'">
                            <ng-include src="'/includes/profileDiffConformance.html'"></ng-include>

                        </div>

                        <div ng-show="selectedItemType == 'example'">
                            <div class="row rounded-box">
                                <div class="col-sm-4 col-md-4">
                                    <strong>Example:{{selectedItem.url}} </strong>
                                </div>

                                <div class="col-sm-5 col-md-5">
                                    <em>{{selectedItem.description}}</em>
                                </div>
                                <div class="col-sm-3 col-md-3">
                                    <div class="pull-right" style="margin-top: 8px">
                                        <i class="glyphicon glyphicon-edit clickable iconSpacing"
                                           ng-click="editResourceItem(selectedItem)"></i>

                                        <i class="glyphicon glyphicon-remove clickable iconSpacing"
                                           ng-click="deleteResourceItem(selectedItem)"></i>
                                    </div>

                                </div>
                            </div>




                            <div class="row">
                                <div class="col-sm-6 col-md-6">
                                    <pre>{{exampleResource | json}}</pre>
                                </div>
                                <div class="col-sm-6 col-md-6">
                                    <uib-tabset>
                                        <uib-tab heading="Text">
                                            <p ng-bind-html="exampleResource.text.div"></p>
                                        </uib-tab>
                                        <uib-tab heading="Xml">
                                            <pre>{{exampleResourceXml}}</pre>
                                        </uib-tab>
                                    </uib-tabset>




                                </div>
                            </div>
                        </div>

                        <div ng-show="selectedItemType == 'logical'">
                            <div class="row">
                                <div class="col-md-10">
                                    <h4>Logical Model</h4>
                                </div>
                                <div class="col-md-2" ng-show="lmShortCut.shortCut">
                                    <a ng-href="{{lmShortCut.shortCut}}" target="_blank">Open in Logical Modeller</a>
                                </div>
                            </div>

                            <uib-tabset>
                                <uib-tab heading="Tree">
                                    <br/>
                                    <div class="row">
                                        <div class="col-sm-4 col-md-4">
                                            <div id="lmTreeView"></div>
                                        </div>
                                        <div class="col-sm-8 col-md-8">
                                            <ng-include src="'/includes/lmItem.html'"></ng-include>
                                        </div>
                                    </div>


                                </uib-tab>
                                <uib-tab heading="Table">
                                    <br/>


                                    <table class="table table-bordered table-condensed">
                                        <tr><th>Element</th><th>DataType</th><th>isRef</th><th>Mult.</th><th>Mappings</th><th>Description & Comment</th></tr>
                                        <tr ng-repeat="row in LMtreeData">

                                            <td>
                                                <div  ng-style="{ 'padding-left': (row.data.path | pathindent) }"
                                                       >{{row.data.path| lastInPath}}</div>
                                            </td>
                                            <td>
                                                <div uib-popover-html="showDT(row.data.type[0].code)"
                                                     popover-placement="right"
                                                     popover-trigger="'mouseenter'">
                                                    <a target="_blank" ng-href="http://hl7.org/fhir/datatypes.html#{{row.data.type[0].code}}">
                                                        {{row.data.type[0].code}}
                                                    </a>

                                                </div>

                                            </td>
                                            <td><div ng-show="row.data.isReference">Y</div></td>
                                            <td>{{row.data.min}}..{{row.data.max}}</td>
                                            <td>
                                                <div ng-repeat="map in row.data.mappingFromED">
                                                    {{map.identity}}: {{map.map}}
                                                </div>
                                            </td>
                                            <td>
                                                {{row.data.description}}
                                                <div ng-show="row.data.comments">
                                                    <br/>{{row.data.comments}}
                                                </div>

                                                <div ng-show="row.data.isCoded">
                                                    <strong>VS:</strong> {{row.data.selectedValueSet.vs.url}}
                                                    <span ng-show="row.data.selectedValueSet.strength">
                                                        ({{row.data.selectedValueSet.strength}})
                                                    </span>

                                                </div>
                                                <div ng-show="row.data.isReference">
                                                    <strong>Ref:</strong> {{row.data.ed.type[0].targetProfile}}
                                                </div>
                                                <div ng-show="row.data.fhirMappingExtensionUrl">
                                                    <strong>Ext:</strong> {{row.data.fhirMappingExtensionUrl}}
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </uib-tab>

                                <uib-tab heading="Coded Items">
                                    <br/>
                                    <table class="table table-bordered table-condensed">
                                        <tr><th>Element</th><th>DataType</th><th>Url</th><th>Notes</th></tr>
                                        <tr ng-repeat="row in LMtreeData" ng-show="row.data.isCoded">
                                            <td>
                                                <div>{{row.data.path | dropFirstInPath}}</div>
                                            </td>
                                            <td>
                                                {{row.data.type[0].code}}
                                            </td>
                                            <td>
                                                {{row.data.selectedValueSet.vs.url}}

                                                <span ng-show="row.data.selectedValueSet.strength">
                                                    ({{row.data.selectedValueSet.strength}})
                                                </span>
                                            </td>
                                            <td>
                                                {{row.data.description}}

                                                <div ng-show="row.data.comments">
                                                    <br/>{{row.data.comments}}
                                                </div>

                                                <div ng-repeat = "map in row.data.ed.mapping">
                                                    {{map.map | mapComment}}
                                                </div>


                                            </td>

                                        </tr>
                                    </table>

                                </uib-tab>


                                <uib-tab heading="Extensions">
                                    <br/>
                                    <table class="table table-bordered table-condensed">
                                        <tr><th>Element</th><th>Base Resource Type</th><th>Notes</th></tr>
                                        <tr ng-repeat="row in LMtreeData" ng-show="row.data.isExtension">
                                            <td>
                                                <div>{{row.data.path | dropFirstInPath}}</div>
                                            </td>
                                            <td>
                                                <div ng-repeat = "map in row.data.ed.mapping">
                                                    {{map.map | mapPath | dropLastInPath}}
                                                </div>


                                            </td>
                                            <td>
                                                {{row.data.description}}
                                                <div ng-show="row.data.comments">
                                                    <br/>{{row.data.comments}}
                                                </div>


                                                <div ng-repeat = "map in row.data.ed.mapping">
                                                    {{map.map | mapComment}}
                                                </div>

                                                <div ng-show="row.data.isCoded">
                                                    <strong>VS:</strong> {{row.data.selectedValueSet.vs.url}} ({{row.data.selectedValueSet.strength}})
                                                </div>
                                                <div ng-show="row.data.isReference">
                                                    <strong>Ref:</strong> {{row.data.ed.type[0].targetProfile}}
                                                </div>
                                                <div ng-show="row.data.fhirMappingExtensionUrl">
                                                    <strong>Ext:</strong> {{row.data.fhirMappingExtensionUrl}}
                                                </div>
                                            </td>

                                        </tr>
                                    </table>

                                </uib-tab>


                                <uib-tab heading="Mind Map"  select="redrawProfileGraph()"  deselect="input.graphTabIsSelected = false">

                                    <div class="row">
                                        <div class="col-sm-9 col-md-9">
                                            <div id="mmLogicalModel"></div>
                                        </div>
                                        <div class="col-sm-3 col-md-3">
                                            <div>{{selectedNodeInLMGraph.ed.definition}}</div>
                                            <div ng-repeat="map in selectedNodeInLMGraph.ed.mapping">
                                                {{map.identity}}:{{map.map}}
                                            </div>
                                            <div>{{map.binding.valueSetReference.reference}}</div>

                                            <pre>{{selectedNodeInLMGraph | json}}</pre>
                                        </div>
                                    </div>

                                </uib-tab>
                                <uib-tab heading="Documentation">
                                    <div class="row" ng-controller="docCtrl">
                                        <div class="col-md-4">
                                            <br/>
                                            <div ng-show="isDirty" class="pull-right btn btn-link" ng-click="saveDoc(LMSD)">Save</div>
                                            <div class="btn-group">

                                                <label ng-repeat = "sect in sections" class="btn btn-default"
                                                       ng-model="doc.resourceDocType" uib-btn-radio="sect.code">
                                                    {{sect.display}}
                                                </label>

                                            </div>
                                            <br/>

                                            <textarea ng-model="doc.resourceDoc[doc.resourceDocType]"
                                                      rows=20 class="form-control" ng-change="makeDoc();isDirty=true">

                                            </textarea>
                                        </div>
                                        <div class="col-md-8">

                                            <uib-tabset>
                                                <uib-tab heading="Full documentation">
                                                    <p ng-bind-html="fullResourceDoc | markDown"></p>
                                                </uib-tab>
                                                <uib-tab heading="This section only">
                                                    <p ng-bind-html="doc.resourceDoc[doc.resourceDocType] | markDown"></p>
                                                </uib-tab>
                                            </uib-tabset>




                                        </div>
                                    </div>


                                </uib-tab>

                                <uib-tab heading="Json">
                                    <pre>{{LMSD | json}}</pre>
                                </uib-tab>
                            </uib-tabset>

                        </div>

                        <div ng-show="selectedItemType == 'profile'">

                            <h4 ng-show="selectedSD.kind=='resource'">Profiled Resource</h4>
                            <h4 ng-show="selectedSD.kind=='complex-type'">Profiled Datatype</h4>

                            <div class="pull-right" ng-hide="input.displayMode">
                                <em>Use the 'Full Display' checkbox in the Navbar at the top to view other tabs</em>
                            </div>

                            <uib-tabset>

                                <uib-tab heading="Tree View">

                                    <p class="banner"><em>The Profile rendered as a Logical Model - extensions appear as ordinary elements, and sliced elements show the slice name.</em></p>
                                    <div class="row">
                                        <div class="col-sm-4 col-md-4">
                                            <div id="logicalTree"></div>

                                        </div>
                                        <div class="col-sm-8 col-md-8">
                                            <uib-tabset>
                                                <uib-tab heading="Summary">
                                                    <br/>
                                                    <table class="table">
                                                        <tr ng-show="selectedElementInLM.slicing"><td><strong>Discriminator</strong></td><td>
                                                            <div>Discriminator: <span ng-repeat = "d in selectedElementInLM.slicing.discriminator">
                                                        {{selectedElementInLM.path}}.{{d}}  </span></div>
                                                            <div>Ordered: {{selectedElementInLM.slicing.ordered}}</div>
                                                            <div>Rules: {{selectedElementInLM.slicing.rules}}</div>
                                                        </td></tr>

                                                        <tr><td width="15%">Path</td><td>{{selectedElementInLM.path}}</td></tr>
                                                        <tr><td>Multiplicity</td>
                                                            <td>
                                                                {{selectedElementInLM.min}}..{{selectedElementInLM.max}}
                                                                <span ng-show="selectedElementInLM.min == 1
                                                            && selectedElementInLM.base.min ==0
                                                            && selectedElementInLM.path.indexOf('extension') == -1">
                                                            <strong> (This element was optional in the FHIR spec)</strong>
                                                        </span>
                                                            </td></tr>
                                                        <tr><td>Name</td><td>{{selectedElementInLM.name}}</td></tr>
                                                        <tr><td>Title</td><td>{{selectedElementInLM.title}}</td></tr>
                                                        <tr><td>Short</td><td>{{selectedElementInLM.short}}</td></tr>
                                                        <tr><td>Definition</td><td>{{selectedElementInLM.definition}}</td></tr>
                                                        <tr><td>Requirements</td><td>{{selectedElementInLM.requirements}}</td></tr>
                                                        <tr><td>Datatype/s</td>
                                                            <td>
                                                                <div class = 'row' ng-repeat="typ in selectedElementInLM.type">
                                                                    <div class="col-md-2 col-sm-2">{{typ.code}}</div>
                                                                    <div ng-show="typ.profile" class="col-md-10 col-sm-10">{{typ.profile}}</div>
                                                                    <div ng-show="typ.targetProfile" class="col-md-10 col-sm-10">{{typ.targetProfile}}</div>

                                                                </div>

                                                                <div ng-repeat="typ in selectedElementInLM.myMeta.analysis.dataTypes">
                                                                    From Extension Definition: {{typ.code}}
                                                                    <span ng-show="typ.profile"> --> {{typ.profile}}</span>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        <tr ng-show="selectedElementInLM.binding"><td>Binding</td><td>

                                                    <span class="clickable"  ng-click="showValueSet(selectedElementInLM.binding.valueSetReference.reference)">
                                                        {{selectedElementInLM.binding.valueSetReference.reference}}
                                                    </span>


                                                            {{selectedElementInLM.binding.valueSetUri}}
                                                            ({{selectedElementInLM.binding.strength}})
                                                            <div>{{selectedElementInLM.binding.description}}</div>
                                                        </td></tr>


                                                        <tr ng-show="selectedElementInLM.myMeta.analysis.binding"><td>Binding (from Extension)</td><td>

                                                    <span class="clickable"
                                                          ng-click="showValueSet(selectedElementInLM.myMeta.analysis.binding.valueSetReference.reference)">
                                                        {{selectedElementInLM.myMeta.analysis.binding.valueSetReference.reference}}
                                                    </span>


                                                            {{selectedElementInLM.myMeta.analysis.binding.valueSetUri}}
                                                            ({{selectedElementInLM.myMeta.analysis.binding.strength}})
                                                            <div>{{selectedElementInLM.myMeta.analysis.binding.description}}</div>
                                                        </td></tr>


                                                        <tr ng-show="selectedElementInLM.myMeta.fixed"><td>{{selectedElementInLM.myMeta.fixed.key}}</td>
                                                            <td>{{selectedElementInLM.myMeta.fixed.value}}</td>
                                                        </tr>


                                                    </table>

                                                    <div ng-show="selectedElementInLM.myMeta.analysis.url">
                                                <span class = 'clickable' ng-click="showExtensionFromUrl(selectedElementInLM.myMeta.analysis.url)">
                                                    Show extension</span>
                                                    </div>

                                                    <div ng-show="selectedElementInLM && selectedElementInLM.myMeta.analysis && ! selectedElementInLM.myMeta.analysis.url">
                                                        <div class="alert alert-warning">
                                                            This Extension Definition could not be located on the Conformance server
                                                        </div>
                                                    </div>

                                                </uib-tab>
                                                <uib-tab heading="Json">
                                                    <pre>{{selectedElementInLMDisplay | json}}</pre>
                                                </uib-tab>
<!--
                                                <uib-tab>
                                                    <uib-tab-heading>
                                                        Comments <span class="badge" ng-show="commentsForElement.length > 0" >{{commentsForElement.length}}</span>
                                                    </uib-tab-heading>
                                                    <br/>

                                                    <div style="background-color: #dedede">
                                                        <br/>
                                                        <div ng-repeat="comment in commentsForElement  track by $index" style="margin: 8px">
                                                            <div class="panel panel-default comment">
                                                                <div class="comment">
                                                                    <div><strong>{{comment.email}} {{comment.issued | getAgeSeconds}}</strong></div>
                                                                    <div>{{comment.comment}}</div>
                                                                </div>

                                                                <div ng-repeat="reply in comment.replies track by $index">
                                                                    <div class="comment" style="margin-left: 20px">
                                                                        <div><strong>{{reply.email}} {{reply.issued | getAgeSeconds}}</strong></div>
                                                                        <div>{{reply.comment}}</div>
                                                                    </div>
                                                                </div>

                                                                <div class="row">
                                                                    <div class="col-sm-8 col-md-8" style="margin-left: 20px">
                                                                <textarea class="form-control" ng-model="input.commentReply[$index]"
                                                                          placeholder="Enter reply here..."></textarea>
                                                                    </div>
                                                                    <div class="col-sm-3 col-md-3">
                                                                        <button class="btn btn-link" ng-show="input.commentReply[$index]"
                                                                                ng-click="saveNewComment(input.commentReply[$index],comment.id,$index)">Send reply</button>
                                                                    </div>
                                                                </div>

                                                                <br/>
                                                            </div>
                                                        </div>

                                                        <div class="row" ng-show = "selectedEDInLM && user.email">
                                                            <div class="col-sm-9 col-md-9">
                                                                <div style="margin: 16px" class="commentX">
                                                            <textarea class="form-control"
                                                                      ng-model="input.newComment" placeholder="Add new comment">

                                                            </textarea>
                                                                </div>

                                                            </div>
                                                            <div class="col-sm-3 col-md-3">
                                                                <button class="btn btn-link" ng-show="input.newComment"
                                                                        ng-click="saveNewComment(input.newComment)">Save comment</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </uib-tab>

-->
                                                <uib-tab heading="Help">
                                                    <br/>
                                                    <p>This logical model is derived from the Profile (the StructureDefinition resource) as a way
                                                        of presenting a 'user friendly view of the Profile - as opposed to the Logical Models listed
                                                        in the left side bar which were generated by a person (and can be used to create a 'real' profile.
                                                    </p><p>   If the profile allows for further extensions to
                                                    be added, then there is an entry labelled 'extension' to indicate this.</p><p> The items are colour
                                                    coded as follows:</p>
                                                    <ul class="list-unstyled" style="padding-left: 8px">
                                                        <li><span style="color:blueviolet">Purple</span> is an element that is an extension - it has been added to the underlying 'core' resource</li>
                                                        <li><span class="elementRequired">Red</span> is a required field</li>
                                                        <li>The asterisk (*) indicates that multiple entries are allowed.</li>
                                                        <li>The letter 'D' indicates this element is a Discriminator.</li>
                                                        <li>The letter 'F' indicates this element has a fixed value.</li>
                                                    </ul>
                                                    <p>Selecting an element will show more details of that element, including the 'raw' json from
                                                        which the logical model was derived.</p>
                                                </uib-tab>
                                            </uib-tabset>




                                        </div>
                                    </div>
                                </uib-tab>

                                <!--

                                <uib-tab>
                                    <uib-tab-heading>
                                        Comments <span ng-show="commentsThisProfileCount > 0" class="badge">{{commentsThisProfileCount}}</span>
                                    </uib-tab-heading>


                                    <div ng-repeat="(key,value) in commentsThisProfileHash">

                                        <div class="rounded-box-filled">Path: <em>{{key}}</em></div>

                                        <div class="row" ng-repeat="comment in value">
                                            <div class="col-sm-12 col-md-12">
                                                <div class="row">

                                                    <div class="col-md-6 col-sm-6">
                                                        <div><strong>{{comment.email}} {{comment.issued | getAgeSeconds}}</strong></div>
                                                        <div>{{comment.comment}}</div>

                                                    </div>
                                                    <div class="col-md-6 col-sm-6">
                                                        <div ng-repeat = "reply in comment.replies" class="rounded-box">
                                                            <div><strong>{{reply.email}} {{reply.issued | getAgeSeconds}}</strong></div>
                                                            <div>{{reply.comment}}</div>
                                                        </div>

                                                    </div>

                                                </div>
                                                <hr/>
                                            </div>
                                        </div>
                                    </div>

                                </uib-tab>

                                -->

                                <uib-tab heading="Doc">
                                    <iframe ng-src="{{iframeUrl | trustAsResourceUrl}}" height="800px" width="100%"></iframe>

                                </uib-tab>


                                <uib-tab heading="Graph"  select="fitGraph()">
                                    <p class="banner"><em>Relationships between the Profile and other resources, Extensions and ValueSets.</em></p>
                                    <div class="row" ng-show="currentIG">
                                        <div class="col-md-9">
                                            <div style="height: 600px; border: solid 1px gray" id="igModel"></div>
                                        </div>
                                        <div class="col-md-3">
                                            <!--
                                            <h4>Display options</h4>
                                            -->

                                            <uib-tabset>
                                                <br/>
                                                <uib-tab heading="Display Options">
                                                    <br/>
                                                    <table width="100%">

                                                        <tr ng-show="1==2"><td>
                                                            <checkbox ng-model="input.includePatient" ng-change="drawGraph()"></checkbox>
                                                        </td><td>Expand beyond Patient</td></tr>

                                                        <tr><td>
                                                            <checkbox ng-model="input.includeExtensions" ng-change="drawGraph()"></checkbox>
                                                        </td><td>Include Extensions</td></tr>
                                                        <tr><td>
                                                            <checkbox ng-model="input.includeTerminology" ng-change="drawGraph()"></checkbox>
                                                        </td><td>Include Valuesets</td></tr>
                                                        <tr><td>
                                                            <checkbox ng-model="input.includeCore" ng-change="drawGraph()"></checkbox>
                                                        </td><td>Include Core resources</td></tr>
                                                        <tr><td valign="top">
                                                            <checkbox ng-model="input.center" ng-change="centeredNode(input.center)">

                                                            </checkbox>
                                                        </td><td>
                                                            <div style="padding-bottom: 8px">Connections to selected Node</div>
                                                            <checkbox ng-model="input.immediateChildren" ng-change="drawGraph()"></checkbox>
                                                            Immediate children only
                                                        </td></tr>
                                                    </table>


                                                </uib-tab>
                                                <uib-tab heading="Legend">
                                                    <br/>
                                                    <table width="100%">
                                                        <tr><td>Profile</td>
                                                            <td width="50%"><div class="rounded-box form-control" style="background-color: {{itemColours.profile}}">

                                                            </div> </td></tr>
                                                        <tr><td>Core resource type</td>
                                                            <td><div class="rounded-box form-control" style="background-color: {{itemColours.profile_loaded}}">

                                                            </div> </td></tr>
                                                        <tr><td>Extension</td>
                                                            <td><div class="rounded-box form-control" style="background-color: {{itemColours.extension}}">

                                                            </div> </td></tr>
                                                        <tr><td>ValueSet</td>
                                                            <td><div class="rounded-box form-control" style="background-color: {{itemColours.terminology}}">

                                                            </div> </td></tr>
                                                    </table>
                                                </uib-tab>
                                            </uib-tabset>

                                            <br/>
                                            <div ng-show="graphReferences">
                                                <h4>Paths</h4>

                                                <div>{{graphReferences.from.data.url | referenceType}}</div>
                                                <div>-> {{graphReferences.to.data.url | referenceType}}</div>
                                                <ul class="list-group">
                                                    <li class="list-group-item" ng-repeat="(key,value) in graphReferences.pathHash">
                                                        {{value.path | dropFirstInPath}}
                                                        <span class="pull-right">{{value.min}}..{{value.max}}</span>
                                                        <div><em>{{value.short}}</em></div>
                                                        <div><em>{{value.definition}}</em></div>
                                                        <div><em>{{value.comments}}</em></div>

                                                    </li>
                                                </ul>
                                                <!--
                                                                                            <pre>{{graphReferences | json}}</pre>
                                                -->
                                            </div>

                                            <br/>
                                            <div ng-show="selectedNodeFromGraph">
                                                <h4>Selected Node</h4>


                                                <div ng-show = "selectedNodeFromGraph.data.purpose == 'terminology'">
                                            <span class = 'clickable' ng-click="showValueSet(selectedNodeFromGraph.data.url)">
                                                {{selectedNodeFromGraph.data.url}}
                                            </span>
                                                    <div ng-hide="valueSetOptions">
                                                        Unable to retrieve options
                                                    </div>
                                                    <div ng-show="valueSetOptions">
                                                        <h5>Options</h5>
                                                        <ul>
                                                            <li ng-repeat="option in valueSetOptions">{{option.display}} ({{option.code}})</li>
                                                        </ul>
                                                    </div>
                                                </div>

                                                <div ng-show = "selectedNodeFromGraph.data.purpose == 'extension'">
                                        <span class = 'clickable' ng-click="showExtension(selectedNodeFromGraph.data.SD)">
                                            {{selectedNodeFromGraph.data.url}}</span>



                                                </div>

                                                <div ng-show = "selectedNodeFromGraph.data.purpose == 'profile'">
                                                    <div>{{selectedNodeFromGraph.data.url}}</div>
                                                </div>



                                                <br />
                                                <div>{{selectedNodeFromGraph.data.description}}</div>

                                                <button ng-show = "selectedNodeFromGraph.data.purpose == 'profile'"
                                                        class="btn btn-link" ng-click="selectNodeFromGraph()">Select node</button>




                                            </div>


                                        </div>
                                    </div>




                                </uib-tab>

                                <uib-tab heading="Table" ng-show="input.displayMode">

                                    <p class="banner"><em>A tabular view of the Profile. </em></p>
                                    <profile-table items="canonical.item" select-item="selectItem"
                                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                                   show-value-set-e="showValueSet"></profile-table>
                                </uib-tab>

                                <uib-tab heading="Extensions" ng-show="input.displayMode">

                                    <p class="banner"><em>Extensions that this Profile references. Shows Url and any ValueSet references by the Extension.</em></p>
                                    <profile-table items="allExtensions" select-item="selectItem"
                                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                                   show-value-set-e="showValueSet"></profile-table>
                                </uib-tab>

                                <uib-tab heading="ValueSets"  ng-show="input.displayMode">

                                    <p class="banner"><em>ValueSets used by this Profile, including binding information</em></p>
                                    <div class="row">
                                        <div class="col-sm-12 col-md-12">
                                            <table class="table">
                                                <tr><th>ValueSet</th>
                                                    <th uib-popover="If true, ValueSet was included in the IG"
                                                        popover-placement="left"
                                                        popover-trigger="'mouseenter'">Included in IG</th>
                                                    <th>Paths & Binding Strength</th></tr>
                                                <tr ng-repeat="item in profileReport.valueSetArray">
                                                    <td width="40%"><span class="clickable"  ng-click="showValueSet(item.url)">{{item.url}}</span> </td>
                                                    <td><div ng-show="item.included">Yes</div></td>
                                                    <td>
                                                        <table width="100%">
                                                            <tr ng-repeat="row in item.paths">
                                                                <td>{{row.path}} ({{row.min}}..{{row.max}})</td>
                                                                <td width="15%">{{row.strength}}</td>
                                                            </tr>
                                                        </table>

                                                    </td>

                                                </tr>
                                            </table>
                                        </div>

                                    </div>
                                </uib-tab>

                                <uib-tab heading="References" ng-show="input.displayMode">

                                    <p class="banner"><em>The references from this Profile to some other resource</em></p>
                                    <div class="row">
                                        <div class="col-sm-12 col-md-12">
                                            <table class="table">
                                                <tr><th>Paths</th><th>Reference</th></tr>
                                                <tr ng-repeat="item in profileReport.referenceArray">
                                                    <td>
                                                        <table width="100%">
                                                            <tr ng-repeat="row in item.paths">
                                                                <td>{{row.path}} ({{row.min}}..{{row.max}})</td>
                                                                <td width="40%">{{item.url}} </td>
                                                            </tr>
                                                        </table>

                                                    </td>

                                                </tr>
                                            </table>
                                        </div>

                                    </div>

                                </uib-tab>

                                <uib-tab heading="Examples" ng-show="input.displayMode">
                                    <div class="row">
                                        <div class="col-sm-3 col-md-3">

                                            <strong>Type: {{constrainedType}}</strong>

                                            <ul class="list-group">
                                                <li  class="list-group-item" ng-repeat="item in artifacts.example"
                                                     ng-click = "getExample(item)"
                                                     ng-show = "item.type == constrainedType">
                                                    <div class="clickable">{{item.url}}</div>
                                                    <div><em>{{item.description}}</em></div>
                                                </li>
                                            </ul>

                                        </div>
                                        <div class="col-sm-9 col-md-9">
                                            <pre ng-show="exampleResource">{{exampleResource | json}}</pre>
                                        </div>
                                    </div>
                                </uib-tab>

                                <uib-tab heading="Required" ng-show="input.displayMode">

                                    <p class="banner"><em>Elements marked as 'Required' (min = 1)</em></p>
                                    <div class="row">
                                        <div class="col-sm-4 col-md-4">

                                            <div class="myScroll">
                                                <table class="table">
                                                    <tr ng-repeat="req in profileReport.required">
                                                        <td><div class='clickable' ng-click="input.reqSel = req">{{req.path}}</div></td>
                                                    </tr>
                                                </table>
                                            </div>


                                        </div>
                                        <div class="col-sm-8 col-md-8">
                                            <pre>{{input.reqSel | json}}</pre>
                                        </div>
                                    </div>
                                </uib-tab>

                                <uib-tab heading="Mappings" ng-show="input.displayMode">
                                    <br/>

                                    <uib-tabset>


                                        <uib-tab heading="From HL7 v2">
                                            <table class="table table-bordered">
                                                <tr ng-repeat="v2 in arV2">
                                                    <td>{{v2.hl7}}</td>
                                                    <td>
                                                        <div ng-repeat="v in v2.fhir">
                                                            {{v.path}}
                                                        </div>

                                                    </td>
                                                    <td>
                                                        <div ng-repeat="v in v2.fhir">
                                                            {{v.comment}}
                                                        </div>

                                                    </td>
                                                </tr>
                                            </table>
                                        </uib-tab>




                                        <uib-tab heading="Detail">
                                            <br/>
                                            <table class="table table-bordered table-condensed">
                                                <tr><th>Element</th><th>DataType</th><th>Mult.</th><th>Mappings</th><th>Description</th></tr>
                                                <tr ng-repeat="ed in selectedSD.snapshot.element">

                                                    <td>
                                                        <div  ng-style="{ 'padding-left': (ed.path | pathindent) }">{{ed.path| lastInPath}}</div>
                                                    </td>
                                                    <td>
                                                        <div ng-repeat="typ in ed.type">
                                                            {{typ.code}}
                                                        </div>

                                                    </td>

                                                    <td>{{ed.min}}..{{ed.max}}</td>
                                                    <td>
                                                        <div ng-repeat="map in ed.mapping">
                                                            {{map.identity}}: {{map.map}}
                                                        </div>
                                                    </td>
                                                    <td>{{ed.definition}}</td>
                                                </tr>

                                            </table>

                                        </uib-tab>
                                    </uib-tabset>

                                </uib-tab>


                                <uib-tab heading="Paths" ng-show="input.displayMode">

                                    <p class="banner"><em>These are the actual Element Definitions - in order - from the Profile. (StructureDefinition.snapshot.element)</em></p>
                                    <div class="row">
                                        <div class="col-sm-4 col-md-4">
                                            <div class="myScroll">
                                                <ul class="list-group">
                                                    <li class="list-group-item clickable" ng-repeat="element in selectedSD.snapshot.element"
                                                        ng-click = "input.selectedPathED = element" >
                                                        {{element.path}}
                                                    </li>
                                                </ul>
                                            </div>

                                        </div>
                                        <div class="col-sm-8 col-md-8">
                                            <pre>{{input.selectedPathED | json}}</pre>
                                        </div>
                                    </div>
                                </uib-tab>

                                <uib-tab heading="Json" ng-show="input.displayMode">
                                    <p class="banner"><em>The raw Json of the profile (StructureDefinition)</em></p>
                                    <div class="row">
                                        <div class="col-sm-12 col-md-12">
                                            <pre>{{selectedSD | json}}</pre>
                                        </div>

                                    </div>
                                </uib-tab>

                                <uib-tab heading="Errors" ng-show="errorsInLM">
                                    <table class="table table-bordered">
                                        <tr ng-repeat = "err in errorsInLM">
                                            <td>{{err.type}}</td>
                                            <td>{{err.value}}</td>
                                        </tr>
                                    </table>
                                </uib-tab>

                                <uib-tab ng-show="1==2" heading="IG Entry">
                                    <br/>
                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            IG Group
                                        </div>
                                        <div class="col-sm-2 col-md-2">
                                            <select class="form-control" ng-model="selectedItemType"
                                                    ng-change = "input.IGDirty = true"
                                                    ng-options = 'category for category in input.categories'>

                                            </select>

                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            Url for download
                                        </div>
                                        <div class="col-sm-10 col-md-10">
                                            {{appConfigSvc.getCurrentConformanceServer().url}}StructureDefinition/{{selectedSD.id}}

                                        </div>

                                    </div>


                                    <div class="row">
                                        <div class="col-sm-2 col-md-2">
                                            <button class="btn btn-danger" ng-click="updateIG()" ng-show="input.IGDirty">Update IG</button>
                                        </div>

                                    </div>

                                </uib-tab>

                            </uib-tabset>

                        </div>

                        <div ng-show="selectedItemType == 'extension'">
                            <h4>Extension: {{selectedExtension.url}}</h4>
                            <div ng-show="extDefNotFound" class="alert alert-warning">
                                {{extDefNotFound.msg}}
                            </div>
                            <uib-tabset>

                                <uib-tab heading="Analysis">
                                    <br/>

                                    <fhir-extension analyse="selectedExtensionAnalysis"
                                                    showvs="showValueSet(url)"></fhir-extension>


                                    <div ng-show="igGraphHash[selectedItem.url].usedBy">
                                        <h5>Used By:</h5>
                                        <ul class="list-unstyled">
                                            <li ng-repeat="url in igGraphHash[selectedItem.url].usedBy track by $index">
                                                {{url}}
                                            </li>
                                        </ul>


                                    </div>


                                </uib-tab>

                                <uib-tab heading="Json">
                                    <br/>
                                    <pre>{{selectedExtension | json}}</pre>
                                </uib-tab>


                            </uib-tabset>


                        </div>

                        <div ng-show="selectedItemType == 'valueset'">
                            <!--
                            <h4>Terminology: {{selectedValueset.resourceType}}</h4>
                            -->

                            <uib-tabset>

                                <uib-tab heading="Description">
                                    <br/>

                                    <div class="row">
                                        <div class="col-sm-6 col-md-6">
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Name</div>
                                                <div class="col-sm-10 col-md-10">{{selectedValueset.name}}</div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Description</div>
                                                <div class="col-sm-10 col-md-10">{{selectedValueset.description}}</div>
                                            </div>
                                            <div class="row" ng-show="selectedValueset.valueSet">
                                                <div class="col-sm-2 col-md-2">ValueSet</div>
                                                <div class="col-sm-10 col-md-10">{{selectedValueset.valueSet}}</div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-md-6">
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Url</div>
                                                <div class="col-sm-10 col-md-10">{{selectedValueset.url}}</div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Publisher</div>
                                                <div class="col-sm-10 col-md-10">{{selectedValueset.publisher}}</div>
                                            </div>
                                            <div class="row" ng-show="selectedValueset.content">
                                                <div class="col-sm-2 col-md-2">Content</div>
                                                <div class="col-sm-10 col-md-10">{{selectedValueset.content}}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <br/>
                                    <a href="#" ng-show="selectedValueset.resourceType=='ValueSet'" class="clickableDotted"
                                       ng-click="showValueSet(selectedValueset.url)">Explore ValueSet</a>



                                    <div ng-show="igGraphHash[selectedItem.url].usedBy">
                                        <h5>Used By:
                                            <ul class="list-unstyled">
                                                <li ng-repeat="url in igGraphHash[selectedValueset.url].usedBy track by $index">
                                                    {{url}}
                                                </li>
                                            </ul>
                                        </h5>

                                    </div>

                                    <br/> <br/>
                                    <div ng-show="valueSetOptions">
                                        <h5>Options</h5>
                                        <table class="table table-bordered">
                                            <tr><th>Code</th><th>Display</th><th>System</th></tr>
                                            <tr ng-repeat="option in valueSetOptions">
                                                <td>{{option.code}}</td>
                                                <td>{{option.display}}</td>
                                                <td>{{option.system}}</td>
                                            </tr>
                                        </table>
                                      <!--  <ul>
                                            <li ng-repeat="option in valueSetOptions">{{option.display}} ({{option.code}})</li>
                                        </ul>-->
                                        <br/>
                                    </div>



                                    <div class="alert alert-error" ng-show="valueSetExpandError">
                                        <h4>Errors expanding ValueSet</h4>
                                        <table class="table">
                                            <tr><th>Code</th><th>Severity</th><th>details</th><th>Diagnostics</th></tr>
                                            <tr ng-repeat="iss in valueSetExpandError.issue">
                                                <td>{{iss.code}}</td>
                                                <td>{{iss.severity}}</td>
                                                <td><pre ng-show="iss.details">{{iss.details}}</pre></td>
                                                <td>{{iss.diagnostics}}</td>
                                            </tr>
                                        </table>



                                    </div>





                                </uib-tab>

                                <uib-tab heading="Json">
                                    <br/>
                                    <pre>{{selectedValueset | json}}</pre>
                                </uib-tab>


                            </uib-tabset>

                        </div>

                        <div ng-show="selectedItemType == 'codesystem'">
                            <h4>CodeSystem: {{selectedValueset.resourceType}}</h4>
                            <uib-tabset>
                                <uib-tab heading="Contents">
                                    <br/>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6">
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Name</div>
                                                <div class="col-sm-10 col-md-10">{{selectedCodeSystem.name}}</div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Description</div>
                                                <div class="col-sm-10 col-md-10">{{selectedCodeSystem.description}}</div>
                                            </div>

                                        </div>

                                        <div class="col-sm-6 col-md-6">
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Url</div>
                                                <div class="col-sm-10 col-md-10">{{selectedCodeSystem.url}}</div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-2 col-md-2">Publisher</div>
                                                <div class="col-sm-10 col-md-10">{{selectedCodeSystem.publisher}}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div ng-show="selectedCodeSystem.concept">
                                        <br/>
                                        <table class="table table-bordered">
                                            <tr><th>Code</th><th>Display</th><th>Definition</th></tr>
                                            <tr ng-repeat="code in selectedCodeSystem.concept">
                                                <td>{{code.code}}</td>
                                                <td>{{code.display}}</td>
                                                <td>{{code.definition}}</td>



                                            </tr>

                                        </table>
                                    </div>
                                </uib-tab>
                                <uib-tab heading="Json">
                                    <pre>{{selectedCodeSystem | json}}</pre>
                                </uib-tab>
                            </uib-tabset>

                        </div>


                    </div>
                </div>


            </uib-tab>
            <uib-tab heading="Description">
                <br/>
                <ng-include src="'/includes/IGSummary.html'"></ng-include>

            </uib-tab>

            <uib-tab heading="IG Json">
                <br/>
                <em>This page is the actual ImplementationGuide resource and intended only for debugging</em>
                <pre>{{currentIG | json}}</pre>
            </uib-tab>


        </uib-tabset>

        <hr/>


    </div>








    <!--

      <!-- This is the UI for the comaprison - to be moved to a new app
    <div>

        <div class="row">

            <div class="col-md-2">
                <select class="form-control" ng-model="input.compareServerLeft"
                        ng-change="loadCompProfiles('Left')"
                        ng-options="svr.name for svr in appConfigSvc.getAllServers()">
                </select>
            </div>

            <div class="col-md-4">
                <select class="form-control" ng-model="input.profileLeft"
                        ng-change="selectCompProfile(input.profileLeft,'Left')"
                        ng-options="entry.resource.url for entry in input.matchingProfilesLeft.entry">
                </select>
            </div>


            <div class="col-md-2" style="border-left: solid 1px gray">
                <select class="form-control" ng-model="input.compareServerRight"
                        ng-change="loadCompProfiles('Right')"
                        ng-options="svr.name for svr in appConfigSvc.getAllServers()">
                </select>
            </div>

            <div class="col-md-4">
                <select class="form-control" ng-model="input.profileRight"
                        ng-change="selectCompProfile(input.profileRight,'Right')"
                        ng-options="entry.resource.url for entry in input.matchingProfilesRight.entry">
                </select>
            </div>

        </div>






        <div class="row">
            <div class="col-md-6 myScroll">
                <profile-table items="canonicalLeft.item" select-item="selectItem"
                               show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                               show-value-set-e="showValueSet"></profile-table>

            </div>
            <div class="col-md-6 myScroll" style="border-left: solid 1px gray">
                <profile-table items="canonicalRight.item" select-item="selectItem"
                               show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                               show-value-set-e="showValueSet"></profile-table>

            </div>
        </div>


    </div>


    -->


    <vs-browser trigger="showVSBrowserDialog" hidesearch="true"
                vs-selected="vsSelected"></vs-browser>


</div>
</body>
</html>