<!DOCTYPE html>
<html>
<head lang="en">
    <base href="/" />
    <meta charset="UTF-8">
    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-2.0.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>

    <script src="js/libs/moment.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>

    <link rel="stylesheet" type="text/css" href="css/jsTreeStyle.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsTreeThemes/proton/style.css"/>

    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>


    <script src="js/libs/angular-sanitize.js"></script>
    <script src="js/libs/firebase.js"></script>
    <script src="js/libs/angularfire.min.js"></script>


    <script>
        angular.module("sampleApp",['ui.bootstrap','ngStorage','ui.checkbox',"firebase"]).config(function($locationProvider) {

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');
        });
        angular.module("sampleApp").constant("moment", moment);

        window.onerror = function(message, url, linenumber) {
            if (message.indexOf('QuotaExceededError') > -1) {
                alert("It looks as if you've run out of cache memory. Use the Clear Cache option on the NavBar to clear it.")
            } else {
                alert("An unexpected error occurred: " + message + " on line " + linenumber + " for " + url);
            }

        }



    </script>

    <script src="js/appConfigSvc.js"></script>
    <script src="js/libs/ngStorage.min.js"></script>
    <script src="js/libs/jstree.min.js"></script>
    <script src="js/profileDiffCtl.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <script src="js/resourceCreatorSvc.js"></script>
    <script src="resourceBuilder/rbServices.js"></script>

    <script src="js/profileCreatorSvc.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/builderSvc.js"></script>
    <script src="js/services.js"></script>
    <script src="js/filters.js"></script>

    <script src="js/profileDiffSvc.js"></script>
    <script src="js/logicalModelSvc.js"></script>
    <script src="js/modellerFilters.js"></script>
    <script src="resourceBuilder/vsBrowser.js"></script>
    <script src="resourceBuilder/rbServices.js"></script>
    <script src="directive/profiletable/profileTable.js"></script>

    <script src="js/libs/vis.min.js"></script>
    <script src="js/components/extensionDirective.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/libs/angular-bootstrap-checkbox.js"></script>


    <!--


  <script src="js/appConfigSvc.js"></script>
  <script src="js/libs/ngStorage.min.js"></script>
  <script src="resourceBuilder/rbServices.js"></script>
  <script src="js/components/dataTypes.js"></script>

  <script src="js/services.js"></script>

  <script src="js/filters.js"></script>
  <script src="js/documentBuilder.js"></script>
  <script src="resourceBuilder/rbServices.js"></script>
  <script src="js/reporterCtrl.js"></script>

  <script src="js/libs/ngStorage.min.js"></script>



  <script src="js/profileCreatorSvc.js"></script>
  -->

    <script>
        var config = {
            apiKey: "AIzaSyBNMohLbPiSKwpGwfARopdeW_6LLXujcUo",
            authDomain: "clinfhir.firebaseapp.com",
            databaseURL: "https://clinfhir.firebaseio.com",
            storageBucket: ""
        };

        //  console.log(firebase)
        if (firebase) {
            firebase.initializeApp(config);

        }
    </script>

    <style>
        .myScroll {
            height: 800px;
            overflow-y: scroll;
        }
        .myRequired {
            color:red;
            background-color:  mistyrose;
        }
        .extension {
            color:blue;
            background-color: powderblue;
        }
        .borderTop {
            border-top: 2pt solid black
        }

    </style>
        <title>IG Viewer</title>

</head>


<body style="padding: 8px;padding-top: 80px" >

<div ng-app="sampleApp" ng-controller="profileDiffCtrl" class="container-fluid">


    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">

        <div class="container-fluid">
            <div class="col-md-2">
                <a class="navbar-brand" href="#">
                    Implementation Guide Viewer
                </a>
            </div>



            <div class="col-md-5 col-sm-5">
                <div class="navbar-text">
                    Conformance:{{appConfigSvc.getCurrentConformanceServer().name}}
                    <div>Terminology:{{appConfigSvc.getCurrentTerminologyServer().name}}</div>
                </div>
            </div>


            <div class="col-md-1 col-sm-1">

                <form class="navbar-form navbar-left">
                    <img ng-show="waiting" src="css/ajax_loader_blue_32.gif"/>
                </form>

            </div>

            <div class="col-md-1 col-sm-1">
                <form ng-show="selectedSD && !loadedFromBookmark" class="navbar-form">
                    <button class="btn btn-success pull-right iconSpacing" ng-click="generateShortCut()">Share</button>
                </form>
            </div>


            <div class="col-md-2 col-sm-2">
                <div class="navbar-text">
                    <div><a href="#" ng-click="clearCache()">Clear Cache</a></div>
                    <div><a href="#" ng-click="createDownload()">Create download</a></div>
                </div>
            </div>

            <div class="col-md-1 col-sm-1">
                <div class="navbar-text pull-right">
                    User: {{orionUser.primaryActor.fullName}}
                </div>
            </div>

        </div>
    </nav>

    <span class="pull-left" ng-show="input.tabShowing=='comp'">

         <select class="form-control" ng-model="input.compareResourceType"
                 ng-change="loadCompProfiles('Left')"
                 ng-options="typ.name for typ in allResourceTypes">
        </select>
    </span>


    <uib-tabset>
        <uib-tab heading="Single Detail" select="input.tabShowing = 'single'" class="pull-right">

            <br/>

            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <uib-tabset>
                        <uib-tab heading="Implementation Guide">
                            <br/>


<!--
                    <h4>Implementation Guides</h4>
-->
                    <div class="row">
                        <div class="col-sm-9 col-md-9">
                            <select class="form-control" ng-model="input.selIG"
                                    ng-options="ig.description for ig in listOfIG">

                            </select>
                        </div>
                        <div class="col-sm-3 col-md-3">
                            <button class="btn btn-success pull-right" ng-click="selectIG(input.selIG)">Load</button>
                        </div>
                    </div>
                    <br/>


                    <div class="myScroll">


                        <uib-accordion ng-show="artifacts">
                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Profiles
                                <div class="pull-right badge">
                                    <span>{{artifacts.profile.length}}</span>
                                </div>

                            </uib-accordion-heading>

                            <ul class="list-group">
                                <li ng-class="{'list-group-item':true, listItemSelected:selectedItem == item}"
                                    ng-repeat="item in artifacts.profile"
                                    ng-click = "selectItem(item,'profile')">
                                    <div class="clickable">{{item.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>

                            </ul>
                            <div class="pull-right"><a href="#" ng-click="importProfile()">Import new</a> </div>
                        </div>

                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Extension Definitions
                                <div class="pull-right">
                                    <!--<i class="glyphicon glyphicon-plus"
                                       title="Add Extension Definition"
                                       ng-click="addEDtoIG()" style="cursor: pointer">

                                    </i>-->
                                    <span class="badge">{{artifacts.extension.length}}</span>
                                </div>
                            </uib-accordion-heading>
                            <ul class="list-group">
                                <li ng-class="{'list-group-item':true, listItemSelected:selectedItem == item}"
                                    ng-repeat="item in artifacts.extension"
                                    ng-click = "selectItem(item,'extension')">
                                    <div class="clickable">{{item.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>
                        </div>

                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Terminology
                                <div class="pull-right badge">{{artifacts.terminology.length}}</div>
                            </uib-accordion-heading>
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat="item in artifacts.terminology"
                                    ng-click = "selectItem(item,'terminology')">
                                    <div class="clickable">{{item.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>
                        </div>

                            <div uib-accordion-group class="panel-default">
                                <uib-accordion-heading>
                                    Logical Models
                                    <div class="pull-right badge">{{artifacts.logical.length}}</div>
                                </uib-accordion-heading>
                                <ul class="list-group">
                                    <li class="list-group-item" ng-repeat="item in artifacts.logical"
                                        ng-click = "selectItem(item,'logical')">
                                        <div class="clickable">{{item.url | referenceType}}</div>
                                        <div><em>{{item.description}}</em></div>
                                    </li>
                                </ul>
                            </div>


                    </uib-accordion>
                    </div>

                        </uib-tab>
                        <uib-tab heading="Lookup">
                            <br/>
                            <div class="row">
                                <div class="col-sm-9 col-md-9">
                                    <select class="form-control" ng-model="input.selResourceType"
                                            ng-options="typ.name for typ in allResourceTypes"
                                            ng-change="findAdhHocProfile(input.selResourceType)">

                                    </select>
                                </div>
                                <!--
                                <div class="col-sm-3 col-md-3">
                                    <button class="btn btn-success pull-right" ng-click="findAdhHocProfile(input.selResourceType)">Find</button>
                                </div>
                                -->
                            </div>
                            <br/>

                            <ul class="list-group">
                                <li ng-class="{'list-group-item':true, profileSelected:selectedItem == item}"
                                    ng-repeat="entry in profilesOnBaseType.entry"
                                    ng-click = "selectAdhHocProfile(entry.resource)">
                                    <div class="clickable">{{entry.resource.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>


                        </uib-tab>
                    </uib-tabset>

                </div>



                <div class="col-sm-9 col-md-9">

                    <uib-tabset>
                        <uib-tab heading="Graph" select="fitGraph()">




                            <div class="row" ng-show="currentIG">
                                <div class="col-md-9">
                                    <div style="height: 600px; border: solid 1px gray" id="igModel"></div>
                                </div>
                                <div class="col-md-3">
                                    <h4>Display options</h4>

                                    <table width="100%">
                                        <!--
                                        <tr><td>
                                            <checkbox ng-model="input.includePatient" ng-change="drawGraph()"></checkbox>
                                        </td><td>Expand beyond Patient</td></tr>
                                        -->
                                        <tr><td>
                                            <checkbox ng-model="input.includeExtensions" ng-change="drawGraph()"></checkbox>
                                        </td><td>Include Extensions</td></tr>
                                        <tr><td>
                                            <checkbox ng-model="input.includeTerminology" ng-change="drawGraph()"></checkbox>
                                        </td><td>Include Valuesets</td></tr>
                                        <tr><td>
                                            <checkbox ng-model="input.includeCore" ng-change="drawGraph()"></checkbox>
                                        </td><td>Include Core resources</td></tr>
                                        <tr><td valign="top">
                                            <checkbox ng-model="input.center" ng-change="centeredNode(input.center)">

                                            </checkbox>
                                        </td><td>
                                            <div style="padding-bottom: 8px">Connections to selected Node</div>
                                            <checkbox ng-model="input.immediateChildren" ng-change="drawGraph()"></checkbox>
                                            Immediate children only
                                        </td></tr>
                                    </table>


                                    <br/>
                                    <div ng-show="graphReferences">
                                        <h4>Paths</h4>
                                        <div>{{graphReferences.from.data.url | referenceType}}</div>
                                        <div>--> {{graphReferences.to.data.url | referenceType}}</div>
                                        <ul class="list-group">
                                            <li class="list-group-item" ng-repeat="(key,value) in graphReferences.pathHash">
                                                {{value.path | dropFirstInPath}}
                                                <span class="pull-right">{{value.min}}..{{value.max}}</span>
                                                <div><em>{{value.short}}</em></div>
                                                <div><em>{{value.definition}}</em></div>
                                                <div><em>{{value.comments}}</em></div>

                                            </li>
                                        </ul>

                                        <pre>{{graphReferences | json}}</pre>

                                    </div>

                                    <br/>
                                    <div ng-show="selectedNodeFromGraph">
                                        <h4>Selected Node</h4>
                                        <div ng-show = "selectedNodeFromGraph.data.purpose == 'terminology'">
                                            <span class = 'clickable' ng-click="showValueSet(selectedNodeFromGraph.data.url)">
                                                {{selectedNodeFromGraph.data.url}}</span>
                                        </div>

                                        <div ng-show = "selectedNodeFromGraph.data.purpose == 'extension'">
                                            <span class = 'clickable' ng-click="showExtension(selectedNodeFromGraph.data.SD)">
                                                {{selectedNodeFromGraph.data.url}}</span>
                                        </div>

                                        <div ng-show = "selectedNodeFromGraph.data.purpose == 'profile'">
                                            <div>{{selectedNodeFromGraph.data.url}}</div>
                                        </div>



                                        <br />
                                        <div>{{selectedNodeFromGraph.data.description}}</div>

                                        <button ng-show = "selectedNodeFromGraph.data.purpose == 'profile'" class="btn btn-link" ng-click="selectNodeFromGraph()">Select node</button>
<!--
                                        <pre>{{selectedNodeFromGraph | json}}</pre>
                                        -->

                                    </div>



                                </div>
                            </div>





                        </uib-tab>
                        <uib-tab>

                            <uib-tab-heading>Details of Resource: <strong>{{selectedItem.url | referenceType}}</strong></uib-tab-heading>


                    <div ng-show="selectedItemType == 'logical'">
                        <h4>Logical Model</h4>
                        <div id="lmTreeView"></div>
                    </div>

                    <div ng-show="selectedItemType == 'profile'">
                        <h4>Profiled resource</h4>

                        <uib-tabset>

                            <uib-tab heading="Logical View">
                                <br/>
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">
                                        <div id="logicalTree"></div>

                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <pre>{{selectedElementInLM | json}}</pre>

                                    </div>
                                </div>
                            </uib-tab>


                            <uib-tab heading="Table">
                                <profile-table items="canonical.item" select-item="selectItem"
                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                   show-value-set-e="showValueSet"></profile-table>
                            </uib-tab>



                            <uib-tab heading="Extensions">
                                <br/>
                                <profile-table items="allExtensions" select-item="selectItem"
                                               show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                               show-value-set-e="showValueSet"></profile-table>
                            </uib-tab>

                            <uib-tab heading="Required Elements">
                                <br/>
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">

                                        <div class="myScroll">
                                            <table class="table">
                                                <tr ng-repeat="req in profileReport.required">
                                                    <td><div class='clickable' ng-click="input.reqSel = req">{{req.path}}</td>
                                                </tr>
                                            </table>
                                        </div>


                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <pre>{{input.reqSel | json}}</pre>
                                    </div>
                                </div>
                            </uib-tab>

                            <uib-tab heading="ValueSets used">
                                <br/>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <table class="table">
                                            <tr><th>ValueSet</th><th>Paths & Binding Strength</th></tr>
                                            <tr ng-repeat="item in profileReport.valueSetArray">
                                                <td width="40%"><span class="clickable"  ng-click="showValueSet(item.url)">{{item.url}}</span> </td>
                                                <td>
                                                    <table width="100%">
                                                        <tr ng-repeat="row in item.paths">
                                                            <td>{{row.path}} ({{row.min}}..{{row.max}})</td>
                                                            <td width="15%">{{row.strength}}</td>
                                                        </tr>
                                                    </table>

                                                </td>

                                            </tr>
                                        </table>
                                    </div>

                                </div>
                            </uib-tab>

                            <uib-tab heading="References">
                                <br/>

                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <table class="table">
                                            <tr><th>Reference</th><th>Paths</th></tr>
                                            <tr ng-repeat="item in profileReport.referenceArray">
                                                <td width="40%"><span class="clickable">{{item.url}}</span> </td>
                                                <td>
                                                    <table width="100%">
                                                        <tr ng-repeat="row in item.paths">
                                                            <td>{{row.path}} ({{row.min}}..{{row.max}})</td>

                                                        </tr>
                                                    </table>

                                                </td>

                                            </tr>
                                        </table>
                                    </div>

                                </div>

                            </uib-tab>



                            <uib-tab heading="Raw tree">
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">
                                        <div class="myScroll">
                                            <div id="profileTree"></div>
                                        </div>

                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <pre>{{selectedED | json}}</pre>
                                    </div>
                                </div>
                            </uib-tab>

                            <uib-tab heading="Paths">
                                <br/>
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">
                                        <div class="myScroll">
                                            <ul class="list-group">
                                                <li class="list-group-item clickable" ng-repeat="element in selectedSD.snapshot.element"
                                                    ng-click = "input.selectedPathED = element" >
                                                    {{element.path}}
                                                </li>
                                            </ul>
                                        </div>

                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <pre>{{input.selectedPathED | json}}</pre>
                                    </div>
                                </div>
                            </uib-tab>

                            <uib-tab heading="Json">
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <pre>{{selectedSD | json}}</pre>
                                    </div>

                                </div>
                            </uib-tab>

                            <uib-tab heading="IG Entry">
                                <br/>
                                <div class="row">
                                    <div class="col-sm-2 col-md-2">
                                        IG Group
                                    </div>
                                    <div class="col-sm-2 col-md-2">
                                        <select class="form-control" ng-model="selectedItemType"
                                                ng-change = "input.IGDirty = true"
                                                ng-options = 'category for category in input.categories'>

                                        </select>

                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-sm-2 col-md-2">
                                        <button class="btn btn-danger" ng-click="updateIG()" ng-show="input.IGDirty">Update IG</button>
                                    </div>


                                </div>


                            </uib-tab>


                        </uib-tabset>

                    </div>

                    <div ng-show="selectedItemType == 'extension'">
                        <h4>Extension: {{selectedExtension.url}}</h4>
                        <uib-tabset>

                            <uib-tab heading="Analysis">
                                <br/>
                                <fhir-extension analyse="selectedExtensionAnalysis" ></fhir-extension>


                                <div ng-show="igGraphHash[selectedItem.url].usedBy">
                                    <h5>Used By:
                                        <ul class="list-unstyled">
                                            <li ng-repeat="url in igGraphHash[selectedItem.url].usedBy track by $index">
                                                {{url}}
                                            </li>
                                        </ul>
                                    </h5>

                                </div>


                            </uib-tab>
                            <uib-tab heading="Analysis Json">

                                <br/>
                                <pre>{{selectedExtensionAnalysis | json}}</pre>
                            </uib-tab>

                            <uib-tab heading="Json">
                                <br/>
                                <pre>{{selectedExtension | json}}</pre>
                            </uib-tab>


                        </uib-tabset>


                    </div>

                    <div ng-show="selectedItemType == 'terminology'">
                        <h4>Terminology</h4>
                        <uib-tabset>

                            <uib-tab heading="Analysis">
                                <br/>

                                <div ng-show="igGraphHash[selectedItem.url].usedBy">
                                    <h5>Used By:
                                        <ul class="list-unstyled">
                                            <li ng-repeat="url in igGraphHash[selectedItem.url].usedBy track by $index">
                                                {{url}}
                                            </li>
                                        </ul>
                                    </h5>

                                </div>

                            </uib-tab>

                            <uib-tab heading="Json">
                                <br/>
                                <pre>{{selectedValueSet | json}}</pre>
                            </uib-tab>


                        </uib-tabset>



                    </div>



                        </uib-tab>
                        <uib-tab heading="Json">
                            <pre>{{currentIG | json}}</pre>
                        </uib-tab>
                    </uib-tabset>


                </div>
            </div>

        </uib-tab>
        <uib-tab heading="Comparison" class="pull-right" select="input.tabShowing = 'comp'">
            <br/>

            <div class="row">
<!--
                <div class="col-md-2">

                    <select class="form-control" ng-model="input.compareResourceType"
                            ng-change="loadCompProfiles('Left')"
                            ng-options="typ.name for typ in allResourceTypes">
                    </select>
                </div>
                -->

                <div class="col-md-2">
                    <select class="form-control" ng-model="input.compareServerLeft"
                            ng-change="loadCompProfiles('Left')"
                            ng-options="svr.name for svr in appConfigSvc.getAllServers()">
                    </select>
                </div>

                <div class="col-md-4">
                    <select class="form-control" ng-model="input.profileLeft"
                            ng-change="selectCompProfile(input.profileLeft,'Left')"
                            ng-options="entry.resource.url for entry in input.matchingProfilesLeft.entry">
                    </select>
                </div>


                <div class="col-md-2" style="border-left: solid 1px gray">
                    <select class="form-control" ng-model="input.compareServerRight"
                            ng-change="loadCompProfiles('Right')"
                            ng-options="svr.name for svr in appConfigSvc.getAllServers()">
                    </select>
                </div>

                <div class="col-md-4">
                    <select class="form-control" ng-model="input.profileRight"
                            ng-change="selectCompProfile(input.profileRight,'Right')"
                            ng-options="entry.resource.url for entry in input.matchingProfilesRight.entry">
                    </select>
                </div>

            </div>






            <div class="row">
                <div class="col-md-6 myScroll">
                    <profile-table items="canonicalLeft.item" select-item="selectItem"
                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                   show-value-set-e="showValueSet"></profile-table>

                </div>
                <div class="col-md-6 myScroll" style="border-left: solid 1px gray">
                    <profile-table items="canonicalRight.item" select-item="selectItem"
                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                   show-value-set-e="showValueSet"></profile-table>

                </div>
            </div>




        </uib-tab>
    </uib-tabset>




    <vs-browser trigger="showVSBrowserDialog" hidesearch="true"
                vs-selected="vsSelected"></vs-browser>


</div>
</body>
</html>