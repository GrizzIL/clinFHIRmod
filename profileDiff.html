<!DOCTYPE html>
<html>
<head lang="en">
    <base href="/" />
    <meta charset="UTF-8">
    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-2.0.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>

    <script src="js/libs/moment.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>

    <link rel="stylesheet" type="text/css" href="css/jsTreeStyle.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsTreeThemes/proton/style.css"/>

    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>


    <script src="js/libs/angular-sanitize.js"></script>
    <script src="js/libs/firebase.js"></script>
    <script src="js/libs/angularfire.min.js"></script>


    <script>
        angular.module("sampleApp",['ui.bootstrap','ngStorage','ui.checkbox',"firebase"]).config(function($locationProvider) {

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');
        });

        angular.module("sampleApp").config(['$compileProvider', function ($compileProvider) {
            $compileProvider.aHrefSanitizationWhitelist(/^\s*(|blob|):/);
        }]);

        angular.module("sampleApp").constant("moment", moment);

        window.onerror = function(message, url, linenumber) {
            if (message.indexOf('QuotaExceededError') > -1) {
                alert("It looks as if you've run out of cache memory. Use the Clear Cache option on the NavBar to clear it.")
            } else {
                alert("An unexpected error occurred: " + message + " on line " + linenumber + " for " + url);
            }
        }

    </script>

    <script src="js/appConfigSvc.js"></script>
    <script src="js/libs/ngStorage.min.js"></script>
    <script src="js/libs/jstree.min.js"></script>
    <script src="js/profileDiffCtl.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <script src="js/resourceCreatorSvc.js"></script>
    <script src="resourceBuilder/rbServices.js"></script>

    <script src="js/profileCreatorSvc.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/builderSvc.js"></script>
    <script src="js/services.js"></script>
    <script src="js/filters.js"></script>

    <script src="js/profileDiffSvc.js"></script>
    <script src="js/logicalModelSvc.js"></script>
    <script src="js/modellerFilters.js"></script>
    <script src="resourceBuilder/vsBrowser.js"></script>
    <script src="resourceBuilder/rbServices.js"></script>
    <script src="directive/profiletable/profileTable.js"></script>

    <script src="js/libs/vis.min.js"></script>
    <script src="js/components/extensionDirective.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/libs/angular-bootstrap-checkbox.js"></script>
    <script src="js/uploadCtrl.js"></script>


    <script>
        var config = {
            apiKey: "AIzaSyBNMohLbPiSKwpGwfARopdeW_6LLXujcUo",
            authDomain: "clinfhir.firebaseapp.com",
            databaseURL: "https://clinfhir.firebaseio.com",
            storageBucket: ""
        };

        if (firebase) {
            firebase.initializeApp(config);
        }

    </script>

    <style>
        .myScroll {
            height: 800px;
            overflow-y: scroll;
        }
        .myRequired {
            color:red;
            background-color:  mistyrose;
        }
        .extension {
            color:blue;
            background-color: powderblue;
        }
        .borderTop {
            border-top: 2pt solid black
        }

    </style>
        <title>IG Viewer</title>

</head>


<body style="padding: 8px;padding-top: 80px" >

<div ng-app="sampleApp" ng-controller="profileDiffCtrl" class="container-fluid">


    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">

        <div class="container-fluid">
            <div class="col-md-2">
                <a class="navbar-brand" href="#">
                    Implementation Guide Viewer
                </a>
            </div>



            <div class="col-md-5 col-sm-5">
                <div class="navbar-text">
                    Conformance:{{appConfigSvc.getCurrentConformanceServer().name}}
                    <div>Terminology:{{appConfigSvc.getCurrentTerminologyServer().name}}</div>
                </div>
            </div>


            <div class="col-md-1 col-sm-1">

                <form class="navbar-form navbar-left">
                    <img ng-show="waiting" src="css/ajax_loader_blue_32.gif"/>
                </form>

            </div>

            <div class="col-md-1 col-sm-1">
                <form ng-show="currentIG && !loadedFromBookmark" class="navbar-form">
                    <button class="btn btn-success pull-right iconSpacing" ng-click="generateShortCut()">Share</button>
                </form>
            </div>


            <div class="col-md-2 col-sm-2">
                <div class="navbar-text">
                    <div><a href="#" ng-click="clearCache()">Clear Cache</a></div>
                    <div><a href="#" ng-show="currentIG" ng-click="createDownload()">Download</a>




                    </div>
                </div>
            </div>

            <div class="col-md-1 col-sm-1">
                <div class="navbar-text pull-right">
                    User: {{orionUser.primaryActor.fullName}}
                </div>
            </div>

        </div>
    </nav>

    <span class="pull-left" ng-show="input.tabShowing=='comp'">

         <select class="form-control" ng-model="input.compareResourceType"
                 ng-change="loadCompProfiles('Left')"
                 ng-options="typ.name for typ in allResourceTypes">
        </select>
    </span>


    <uib-tabset>
        <uib-tab heading="Single Detail" select="input.tabShowing = 'single'" class="pull-right">

            <br/>

            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <uib-tabset>
                        <uib-tab heading="Implementation Guide">
                            <br/>

                    <div class="row">
                        <div class="col-sm-9 col-md-9">
                            <select class="form-control" ng-model="input.selIG"
                                    ng-options="ig.name for ig in listOfIG">

                            </select>
                        </div>
                        <div class="col-sm-3 col-md-3">
                            <button class="btn btn-success pull-right" ng-click="selectIG(input.selIG)">Load</button>
                        </div>
                    </div>
                    <br/>


                    <div class="myScroll">


                        <uib-accordion ng-show="artifacts">
                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Profiles
                                <div class="pull-right badge">
                                    <span>{{artifacts.profile.length}}</span>
                                </div>

                            </uib-accordion-heading>

                            <ul class="list-group">
                                <li ng-class="{'list-group-item':true, listItemSelected:selectedItem == item}"
                                    ng-repeat="item in artifacts.profile"
                                    ng-click = "selectItem(item,'profile')">


                                    <div class="pull-right" ng-click="downLoadItem($event,item)">

                                        <i class="glyphicon glyphicon-cloud clickable"
                                           title="Download"
                                           style="cursor: pointer">


                                        </i></div>


                                    <div class="clickable">{{item.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>

                            </ul>
                            <div class="pull-right"><a href="#" ng-click="importItem({type:'profile',display:'Profile'})">Import new</a> </div>
                        </div>

                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Extension Definitions
                                <div class="pull-right">
                                    <!--<i class="glyphicon glyphicon-plus"
                                       title="Add Extension Definition"
                                       ng-click="addEDtoIG()" style="cursor: pointer">

                                    </i>-->
                                    <span class="badge">{{artifacts.extension.length}}</span>
                                </div>
                            </uib-accordion-heading>
                            <ul class="list-group">
                                <li ng-class="{'list-group-item':true, listItemSelected:selectedItem == item}"
                                    ng-repeat="item in artifacts.extension"
                                    ng-click = "selectItem(item,'extension')">
                                    <div class="clickable">{{item.url | referenceType}}


                                    </div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>
                            <div class="pull-right"><a href="#" ng-click="importItem({type:'extension',display:'Extension Definition'})">Import new</a> </div>
                        </div>

                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Terminology
                                <div class="pull-right badge">{{artifacts.terminology.length}}</div>
                            </uib-accordion-heading>
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat="item in artifacts.terminology"
                                    ng-click = "selectItem(item,'terminology')">
                                    <div class="clickable">{{item.url | referenceType}}
                                        <span ng-show="item.url.indexOf('hl7.org/fhir') > -1"   class="pull-right">
                                            <i title="Official FHIR resource" style = 'color: red' class="glyphicon glyphicon-fire" ></i>
                                        </span>
                                    </div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>
                        </div>

                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Logical Models
                                <div class="pull-right badge">{{artifacts.logical.length}}</div>
                            </uib-accordion-heading>
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat="item in artifacts.logical"
                                    ng-click = "selectItem(item,'logical')">
                                    <div class="clickable">{{item.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>
                            <div class="pull-right"><a href="#" ng-click="importItem({type:'logical',display:'Logical Model'})">Import new</a> </div>
                        </div>

                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Examples
                                <div class="pull-right badge">{{artifacts.example.length}}</div>
                            </uib-accordion-heading>
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat="item in artifacts.example"
                                    ng-click = "selectItem(item,'example')">
                                    <div class="clickable">{{item.url}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>

                            <div class="pull-right"><a href="#" ng-click="uploadExample(selectedItem)">Import new</a> </div>

                        </div>

                        <div uib-accordion-group class="panel-default">
                            <uib-accordion-heading>
                                Other artifacts
                                <div class="pull-right badge">{{artifacts.other.length}}</div>
                            </uib-accordion-heading>
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat="item in artifacts.other"
                                    ng-click = "selectItem(item,'other')">
                                    <div class="clickable">{{item.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>
                            <!--
                            <div class="pull-right"><a href="#" ng-click="importItem({type:'logical',display:'Logical Model'})">Import new</a> </div>
                            -->
                        </div>


                    </uib-accordion>
                    </div>

                        </uib-tab>
                        <uib-tab heading="Lookup">
                            <br/>
                            <div class="row">
                                <div class="col-sm-9 col-md-9">
                                    <select class="form-control" ng-model="input.selResourceType"
                                            ng-options="typ.name for typ in allResourceTypes"
                                            ng-change="findAdhHocProfile(input.selResourceType)">

                                    </select>
                                </div>
                                <!--
                                <div class="col-sm-3 col-md-3">
                                    <button class="btn btn-success pull-right" ng-click="findAdhHocProfile(input.selResourceType)">Find</button>
                                </div>
                                -->
                            </div>
                            <br/>

                            <ul class="list-group">
                                <li ng-class="{'list-group-item':true, profileSelected:selectedItem == item}"
                                    ng-repeat="entry in profilesOnBaseType.entry"
                                    ng-click = "selectAdhHocProfile(entry.resource)">
                                    <div class="clickable">{{entry.resource.url | referenceType}}</div>
                                    <div><em>{{item.description}}</em></div>
                                </li>
                            </ul>


                        </uib-tab>
                    </uib-tabset>

                </div>



                <div class="col-sm-9 col-md-9">

                    <uib-tabset ng-show="currentIG">

                        <uib-tab>

                            <uib-tab-heading>Details of Resource: <strong>{{selectedItem.url | referenceType}}</strong></uib-tab-heading>



                    <div ng-show="selectedItemType == 'example'">
                        <h4>Example</h4>
                        {{selectedItem.description}}
                        <pre>{{exampleResource | json}}</pre>
                    </div>

                    <div ng-show="selectedItemType == 'logical'">
                        <h4>Logical Model</h4>

                        <uib-tabset>
                            <uib-tab heading="Tree">
                                <br/>
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">
                                        <div id="lmTreeView"></div>
                                    </div>
                                    <div class="col-sm-4 col-md-4">
                                        <ng-include src="'/includes/lmItem.html'"></ng-include>
                                    </div>
                                </div>


                            </uib-tab>
                            <uib-tab heading="Table">
                                <br/>


                                <table class="table table-bordered table-condensed">
                                    <tr><th>Element</th><th>DataType</th><th>isRef</th><th>Mult.</th><th>Mappings</th><th>Description</th></tr>
                                    <tr ng-repeat="row in LMtreeData">

                                        <td>
                                            <div  ng-style="{ 'padding-left': (row.data.path | pathindent) }"
                                                  ng-click="selectNodeFromTable(row.data.path)" class="clickable" >{{row.data.path| lastInPath}}</div>
                                        </td>
                                        <td>{{row.data.type[0].code}}

                                        </td>
                                        <td><div ng-show="row.data.isReference">Y</div></td>
                                        <td>{{row.data.min}}..{{row.data.max}}</td>
                                        <td>
                                            <div ng-repeat="map in row.data.mappingFromED">
                                                {{map.identity}}: {{map.map}}
                                            </div>
                                        </td>
                                        <td>{{row.data.description}}</td>

                                    </tr>

                                </table>
                            </uib-tab>
                            <uib-tab heading="Json">
                                <pre>{{LMSD | json}}</pre>
                            </uib-tab>
                        </uib-tabset>


                    </div>

                    <div ng-show="selectedItemType == 'profile'">
                        <h4>Profiled resource</h4>

                        <uib-tabset>


                            <uib-tab heading="Graph" select="fitGraph()">
                                <p class="banner"><em>Relationships between the Profile and other resources, Extensions and ValueSets.</em></p>
                                <div class="row" ng-show="currentIG">
                                    <div class="col-md-9">
                                        <div style="height: 600px; border: solid 1px gray" id="igModel"></div>
                                    </div>
                                    <div class="col-md-3">
                                        <!--
                                        <h4>Display options</h4>
                                        -->

                                        <uib-tabset>
                                            <br/>
                                            <uib-tab heading="Display Options">
                                                <br/>
                                                <table width="100%">

                                                    <tr ng-show="1==2"><td>
                                                        <checkbox ng-model="input.includePatient" ng-change="drawGraph()"></checkbox>
                                                    </td><td>Expand beyond Patient</td></tr>

                                                    <tr><td>
                                                        <checkbox ng-model="input.includeExtensions" ng-change="drawGraph()"></checkbox>
                                                    </td><td>Include Extensions</td></tr>
                                                    <tr><td>
                                                        <checkbox ng-model="input.includeTerminology" ng-change="drawGraph()"></checkbox>
                                                    </td><td>Include Valuesets</td></tr>
                                                    <tr><td>
                                                        <checkbox ng-model="input.includeCore" ng-change="drawGraph()"></checkbox>
                                                    </td><td>Include Core resources</td></tr>
                                                    <tr><td valign="top">
                                                        <checkbox ng-model="input.center" ng-change="centeredNode(input.center)">

                                                        </checkbox>
                                                    </td><td>
                                                        <div style="padding-bottom: 8px">Connections to selected Node</div>
                                                        <checkbox ng-model="input.immediateChildren" ng-change="drawGraph()"></checkbox>
                                                        Immediate children only
                                                    </td></tr>
                                                </table>


                                            </uib-tab>
                                            <uib-tab heading="Legend">
                                                <br/>
                                                <table width="100%">
                                                    <tr><td>Profile</td>
                                                        <td width="50%"><div class="rounded-box form-control" style="background-color: {{itemColours.profile}}">

                                                        </div> </td></tr>
                                                    <tr><td>Core resource type</td>
                                                        <td><div class="rounded-box form-control" style="background-color: {{itemColours.profile_loaded}}">

                                                        </div> </td></tr>
                                                    <tr><td>Extension</td>
                                                        <td><div class="rounded-box form-control" style="background-color: {{itemColours.extension}}">

                                                        </div> </td></tr>
                                                    <tr><td>ValueSet</td>
                                                        <td><div class="rounded-box form-control" style="background-color: {{itemColours.terminology}}">

                                                        </div> </td></tr>
                                                </table>
                                            </uib-tab>
                                        </uib-tabset>

                                        <br/>
                                        <div ng-show="graphReferences">
                                            <h4>Paths</h4>

                                            <div>{{graphReferences.from.data.url | referenceType}}</div>
                                            <div>-> {{graphReferences.to.data.url | referenceType}}</div>
                                            <ul class="list-group">
                                                <li class="list-group-item" ng-repeat="(key,value) in graphReferences.pathHash">
                                                    {{value.path | dropFirstInPath}}
                                                    <span class="pull-right">{{value.min}}..{{value.max}}</span>
                                                    <div><em>{{value.short}}</em></div>
                                                    <div><em>{{value.definition}}</em></div>
                                                    <div><em>{{value.comments}}</em></div>

                                                </li>
                                            </ul>

                                            <pre>{{graphReferences | json}}</pre>

                                        </div>

                                        <br/>
                                        <div ng-show="selectedNodeFromGraph">
                                            <h4>Selected Node</h4>


                                            <div ng-show = "selectedNodeFromGraph.data.purpose == 'terminology'">
                                                <span class = 'clickable' ng-click="showValueSet(selectedNodeFromGraph.data.url)">
                                                    {{selectedNodeFromGraph.data.url}}
                                                </span>
                                                <div ng-hide="valueSetOptions">
                                                    Unable to retrieve options
                                                </div>
                                                <div ng-show="valueSetOptions">
                                                    <h5>Options</h5>
                                                    <ul>
                                                        <li ng-repeat="option in valueSetOptions">{{option.display}} ({{option.code}})</li>
                                                    </ul>
                                                </div>
                                            </div>

                                            <div ng-show = "selectedNodeFromGraph.data.purpose == 'extension'">
                                            <span class = 'clickable' ng-click="showExtension(selectedNodeFromGraph.data.SD)">
                                                {{selectedNodeFromGraph.data.url}}</span>
                                            </div>

                                            <div ng-show = "selectedNodeFromGraph.data.purpose == 'profile'">
                                                <div>{{selectedNodeFromGraph.data.url}}</div>
                                            </div>



                                            <br />
                                            <div>{{selectedNodeFromGraph.data.description}}</div>

                                            <button ng-show = "selectedNodeFromGraph.data.purpose == 'profile'" class="btn btn-link" ng-click="selectNodeFromGraph()">Select node</button>

                                        </div>



                                    </div>
                                </div>




                            </uib-tab>


                            <uib-tab heading="Logical View">

                                <p class="banner"><em>The Profile rendered as a Logical Model - extensions appear as ordinary elements.</em></p>
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">
                                        <div id="logicalTree"></div>

                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <uib-tabset>
                                            <uib-tab heading="Summary">
                                                <br/>
                                                <table class="table">
                                                    <tr ng-show="selectedElementInLM.slicing"><td><strong>Discriminator</strong></td><td>
                                                        <div>Discriminator: <span ng-repeat = "d in selectedElementInLM.slicing.discriminator">
                                                            {{selectedElementInLM.path}}.{{d}}  </span></div>
                                                        <div>Ordered: {{selectedElementInLM.slicing.ordered}}</div>
                                                        <div>Rules: {{selectedElementInLM.slicing.rules}}</div>
                                                    </td></tr>

                                                    <tr><td width="15%">Path</td><td>{{selectedElementInLM.path}}</td></tr>
                                                    <tr><td>Multiplicity</td><td>{{selectedElementInLM.min}}..{{selectedElementInLM.max}}</td></tr>
                                                    <tr><td>Name</td><td>{{selectedElementInLM.name}}</td></tr>
                                                    <tr><td>Short</td><td>{{selectedElementInLM.short}}</td></tr>
                                                    <tr><td>Definition</td><td>{{selectedElementInLM.definition}}</td></tr>
                                                    <tr><td>Requirements</td><td>{{selectedElementInLM.requirements}}</td></tr>
                                                    <tr><td>Datatype/s</td>
                                                        <td>

                                                            <div class = 'row' ng-repeat="typ in selectedElementInLM.type">
                                                                <div class="col-md-4 col-sm-4">{{typ.code}}</div>
                                                                <div ng-show="typ.profile" class="col-md-8 col-sm-8">{{typ.profile}}</div>


                                                            </div>


                                                            <div ng-repeat="typ in selectedElementInLM.myMeta.analysis.dataTypes">
                                                                From Extension Definition: {{typ.code}}
                                                                <span ng-show="typ.profile"> --> {{typ.profile}}</span>
                                                            </div>
                                                        </td>
                                                    </tr>

                                                    <tr ng-show="selectedElementInLM.binding"><td>Binding</td><td>

                                                        <span class="clickable"  ng-click="showValueSet(selectedElementInLM.binding.valueSetReference.reference)">
                                                            {{selectedElementInLM.binding.valueSetReference.reference}}
                                                        </span>


                                                        {{selectedElementInLM.binding.valueSetUri}}
                                                        ({{selectedElementInLM.binding.strength}})
                                                        <div>{{selectedElementInLM.binding.description}}</div>
                                                    </td></tr>


                                                    <tr ng-show="selectedElementInLM.myMeta.analysis.binding"><td>Binding (from Extension)</td><td>

                                                        <span class="clickable"
                                                              ng-click="showValueSet(selectedElementInLM.myMeta.analysis.binding.valueSetReference.reference)">
                                                            {{selectedElementInLM.myMeta.analysis.binding.valueSetReference.reference}}
                                                        </span>


                                                        {{selectedElementInLM.myMeta.analysis.binding.valueSetUri}}
                                                        ({{selectedElementInLM.myMeta.analysis.binding.strength}})
                                                        <div>{{selectedElementInLM.myMeta.analysis.binding.description}}</div>
                                                    </td></tr>


                                                    <tr ng-show="selectedElementInLM.myMeta.fixed"><td>{{selectedElementInLM.myMeta.fixed.key}}</td>
                                                        <td>{{selectedElementInLM.myMeta.fixed.value}}</td>
                                                    </tr>


                                                </table>

                                                <div ng-show="selectedElementInLM.myMeta.analysis">
                                                    <span class = 'clickable' ng-click="showExtensionFromUrl(selectedElementInLM.myMeta.analysis.url)">
                                                        Show extension</span>

                                                </div>

                                            </uib-tab>
                                            <uib-tab heading="Json">
                                                <pre>{{selectedElementInLM | json}}</pre>
                                            </uib-tab>
                                            <uib-tab heading="Help">
                                                <br/>
                                                <p>This logical model is derived from the Profile (the StructureDefinition resource) as a way
                                                of presenting a 'user friendly view of the Profile - as opposed to the Logical Models listed
                                                    in the left side bar which were generated by a person (and can be used to create a 'real' profile.
                                                </p><p>   If the profile allows for further extensions to
                                                be added, then there is an entry labelled 'extension' to indicate this.</p><p> The items are colour
                                                coded as follows:</p>
                                                <ul class="list-unstyled" style="padding-left: 8px">
                                                    <li><span style="color:blueviolet">Purple</span> is an element that is an extension - it has been added to the underlying 'core' resource</li>
                                                    <li><span class="elementRequired">Red</span> is a required field</li>
                                                    <li>The asterisk (*) indicates that multiple entries are allowed.</li>
                                                    <li>The letter 'D' indicates this element is a Discriminator.</li>
                                                    <li>The letter 'F' indicates this element has a fixed value.</li>
                                                </ul>
                                                <p>Selecting an element will show more details of that element, including the 'raw' json from
                                                which the logical model was derived.</p>
                                            </uib-tab>
                                        </uib-tabset>




                                    </div>
                                </div>
                            </uib-tab>

                            <uib-tab heading="Table">

                                <p class="banner"><em>A tabular view of the Profile. </em></p>
                                <profile-table items="canonical.item" select-item="selectItem"
                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                   show-value-set-e="showValueSet"></profile-table>
                            </uib-tab>

                            <uib-tab heading="Extensions">

                                <p class="banner"><em>Extensions that this Profile references. Shows Url and any ValueSet references by the Extension.</em></p>
                                <profile-table items="allExtensions" select-item="selectItem"
                                               show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                               show-value-set-e="showValueSet"></profile-table>
                            </uib-tab>

                            <uib-tab heading="Examples">
                                <div class="row">
                                    <div class="col-sm-3 col-md-3">

                                        <strong>Type: {{constrainedType}}</strong>

                                        <ul class="list-group">
                                            <li  class="list-group-item" ng-repeat="item in artifacts.example"
                                                ng-click = "getExample(item)"
                                                ng-show = "item.type == constrainedType">
                                                <div class="clickable">{{item.url}}</div>
                                                <div><em>{{item.description}}</em></div>
                                            </li>
                                        </ul>

                                    </div>
                                    <div class="col-sm-9 col-md-9">
                                        <pre ng-show="exampleResource">{{exampleResource | json}}</pre>
                                    </div>
                                </div>
                            </uib-tab>


                            <uib-tab heading="Required Elements">

                                <p class="banner"><em>Elements marked as 'Required' (min = 1)</em></p>
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">

                                        <div class="myScroll">
                                            <table class="table">
                                                <tr ng-repeat="req in profileReport.required">
                                                    <td><div class='clickable' ng-click="input.reqSel = req">{{req.path}}</div></td>
                                                </tr>
                                            </table>
                                        </div>


                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <pre>{{input.reqSel | json}}</pre>
                                    </div>
                                </div>
                            </uib-tab>

                            <uib-tab heading="ValueSets used">

                                <p class="banner"><em>ValueSets used by this Profile, including binding information</em></p>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <table class="table">
                                            <tr><th>ValueSet</th>
                                                <th uib-popover="If true, ValueSet was included in the IG"
                                                    popover-placement="left"
                                                    popover-trigger="'mouseenter'">Included</th>
                                                <th>Paths & Binding Strength</th></tr>
                                            <tr ng-repeat="item in profileReport.valueSetArray">
                                                <td width="40%"><span class="clickable"  ng-click="showValueSet(item.url)">{{item.url}}</span> </td>
                                                <td><div ng-show="item.included">Yes</div></td>
                                                <td>
                                                    <table width="100%">
                                                        <tr ng-repeat="row in item.paths">
                                                            <td>{{row.path}} ({{row.min}}..{{row.max}})</td>
                                                            <td width="15%">{{row.strength}}</td>
                                                        </tr>
                                                    </table>

                                                </td>
                                                <!--
                                                <td><pre>{{item | json}}</pre></td>
                                                -->
                                            </tr>
                                        </table>
                                    </div>

                                </div>
                            </uib-tab>

                            <uib-tab heading="References">

                                <p class="banner"><em>The references from this Profile to some other resource</em></p>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <table class="table">
                                            <tr><th>Reference</th><th>Paths</th></tr>
                                            <tr ng-repeat="item in profileReport.referenceArray">
                                                <td width="40%"><span class="clickable">{{item.url}}</span> </td>
                                                <td>
                                                    <table width="100%">
                                                        <tr ng-repeat="row in item.paths">
                                                            <td>{{row.path}} ({{row.min}}..{{row.max}})</td>

                                                        </tr>
                                                    </table>

                                                </td>

                                            </tr>
                                        </table>
                                    </div>

                                </div>

                            </uib-tab>

                            <uib-tab heading="Mappings">
                                <br/>

                                <uib-tabset>


                                    <uib-tab heading="From HL7 v2">
                                        <table class="table table-bordered">
                                            <tr ng-repeat="v2 in arV2">
                                                <td>{{v2.hl7}}</td>
                                                <td>
                                                    <div ng-repeat="v in v2.fhir">
                                                        {{v.path}}
                                                    </div>

                                                </td>
                                                <td>
                                                    <div ng-repeat="v in v2.fhir">
                                                        {{v.comment}}
                                                    </div>

                                                </td>
                                            </tr>
                                        </table>
                                    </uib-tab>




                                <uib-tab heading="Detail">
                                    <br/>
                                    <table class="table table-bordered table-condensed">
                                        <tr><th>Element</th><th>DataType</th><th>Mult.</th><th>Mappings</th><th>Description</th></tr>
                                        <tr ng-repeat="ed in selectedSD.snapshot.element">

                                            <td>
                                                <div  ng-style="{ 'padding-left': (ed.path | pathindent) }">{{ed.path| lastInPath}}</div>
                                            </td>
                                            <td>
                                                <div ng-repeat="typ in ed.type">
                                                    {{typ.code}}
                                                </div>

                                            </td>

                                            <td>{{ed.min}}..{{ed.max}}</td>
                                            <td>
                                                <div ng-repeat="map in ed.mapping">
                                                    {{map.identity}}: {{map.map}}
                                                </div>
                                            </td>
                                            <td>{{ed.definition}}</td>
                                        </tr>

                                    </table>

                                </uib-tab>
                                </uib-tabset>

                            </uib-tab>

<!--

                            <uib-tab heading="Raw tree">
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">
                                        <div class="myScroll">
                                            <div id="profileTree"></div>
                                        </div>

                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <pre>{{selectedED | json}}</pre>
                                    </div>
                                </div>
                            </uib-tab>

                            -->

                            <uib-tab heading="Paths">

                                <p class="banner"><em>These are the actual Element Definitions - in order - from the Profile. (StructureDefinition.snapshot.element)</em></p>
                                <div class="row">
                                    <div class="col-sm-4 col-md-4">
                                        <div class="myScroll">
                                            <ul class="list-group">
                                                <li class="list-group-item clickable" ng-repeat="element in selectedSD.snapshot.element"
                                                    ng-click = "input.selectedPathED = element" >
                                                    {{element.path}}
                                                </li>
                                            </ul>
                                        </div>

                                    </div>
                                    <div class="col-sm-8 col-md-8">
                                        <pre>{{input.selectedPathED | json}}</pre>
                                    </div>
                                </div>
                            </uib-tab>

                            <uib-tab heading="Json">
                                <p class="banner"><em>The raw Json of the profile (StructureDefinition)</em></p>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12">
                                        <pre>{{selectedSD | json}}</pre>
                                    </div>

                                </div>
                            </uib-tab>

                            <uib-tab heading="Errors" ng-show="errorsInLM">
                                <table class="table table-bordered">
                                    <tr ng-repeat = "err in errorsInLM">
                                        <td>{{err.type}}</td>
                                        <td>{{err.value}}</td>
                                    </tr>
                                </table>
                            </uib-tab>

                            <uib-tab ng-show="1==2" heading="IG Entry">
                                <br/>
                                <div class="row">
                                    <div class="col-sm-2 col-md-2">
                                        IG Group
                                    </div>
                                    <div class="col-sm-2 col-md-2">
                                        <select class="form-control" ng-model="selectedItemType"
                                                ng-change = "input.IGDirty = true"
                                                ng-options = 'category for category in input.categories'>

                                        </select>

                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-sm-2 col-md-2">
                                        Url for download
                                    </div>
                                    <div class="col-sm-10 col-md-10">
                                        {{appConfigSvc.getCurrentConformanceServer().url}}StructureDefinition/{{selectedSD.id}}

                                    </div>

                                </div>


                                <div class="row">
                                    <div class="col-sm-2 col-md-2">
                                        <button class="btn btn-danger" ng-click="updateIG()" ng-show="input.IGDirty">Update IG</button>
                                    </div>

                                </div>

                            </uib-tab>

                        </uib-tabset>

                    </div>

                    <div ng-show="selectedItemType == 'extension'">
                        <h4>Extension: {{selectedExtension.url}}</h4>
                        <uib-tabset>

                            <uib-tab heading="Analysis">
                                <br/>
                                <fhir-extension analyse="selectedExtensionAnalysis" ></fhir-extension>


                                <div ng-show="igGraphHash[selectedItem.url].usedBy">
                                    <h5>Used By:
                                        <ul class="list-unstyled">
                                            <li ng-repeat="url in igGraphHash[selectedItem.url].usedBy track by $index">
                                                {{url}}
                                            </li>
                                        </ul>
                                    </h5>

                                </div>


                            </uib-tab>

                            <uib-tab heading="Json">
                                <br/>
                                <pre>{{selectedExtension | json}}</pre>
                            </uib-tab>


                        </uib-tabset>


                    </div>

                    <div ng-show="selectedItemType == 'terminology'">
                        <h4>Terminology</h4>
                        <uib-tabset>

                            <uib-tab heading="Description">
                                <br/>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6">
                                        <div class="row">
                                            <div class="col-sm-2 col-md-2">Name</div>
                                            <div class="col-sm-10 col-md-10">{{selectedValueSet.name}}</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-2 col-md-2">Description</div>
                                            <div class="col-sm-10 col-md-10">{{selectedValueSet.description}}</div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 col-md-6">
                                        <div class="row">
                                            <div class="col-sm-2 col-md-2">Url</div>
                                            <div class="col-sm-10 col-md-10">{{selectedValueSet.url}}</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-2 col-md-2">Publisher</div>
                                            <div class="col-sm-10 col-md-10">{{selectedValueSet.publisher}}</div>
                                        </div>
                                    </div>
                                </div>

                                <div ng-show="igGraphHash[selectedItem.url].usedBy">
                                    <h5>Used By:
                                        <ul class="list-unstyled">
                                            <li ng-repeat="url in igGraphHash[selectedValueSet.url].usedBy track by $index">
                                                {{url}}
                                            </li>
                                        </ul>
                                    </h5>

                                </div>

                                <br/> <br/>
                                <a href="#" ng-click="showValueSet(selectedValueSet.url)">Explore ValueSet</a>


                            </uib-tab>

                            <uib-tab heading="Json">
                                <br/>
                                <pre>{{selectedValueSet | json}}</pre>
                            </uib-tab>


                        </uib-tabset>



                    </div>



                        </uib-tab>
                        <uib-tab heading="Implementation Guide Summary">
                            <br/>
                            <ng-include src="'/includes/IGSummary.html'"></ng-include>

                        </uib-tab>

                        <uib-tab heading="Pages" >
                            <div class="row">


                                <div class="col-md-3 col-sm-3">
                                    <div class="pull-right" style="margin-top: 8px">

                                        <span ng-show="selectedPageNode">
                                            <i class="glyphicon glyphicon-edit clickable iconSpacing"
                                               ng-click="addPage(selectedPageNode)"></i>

                                            <i class="glyphicon glyphicon-remove clickable iconSpacing"
                                               ng-click="deletePage(selectedPageNode)"></i>

                                            <i class="glyphicon glyphicon-arrow-down clickable iconSpacing"
                                               ng-click="move(selectedPageNode,'dn')"></i>
                                            <i class="glyphicon glyphicon-arrow-up clickable iconSpacing"
                                               ng-click="move(selectedPageNode,'up')"></i>

                                        </span>

                                        <i class="glyphicon glyphicon-plus clickable iconSpacing"
                                           ng-click="addPage()"></i>


                                    </div>
                                    <hr style="margin-top: 30px"/>

                                    <div id="pagesTreeView"></div>

                                    <div>


                                        <button class="btn btn-link pull-right" ng-show="pageDirty"
                                                ng-click="savePages()">Save</button>
                                    </div>
<!--
                                    <pre>{{selectedPageNode.data | json}}</pre>

                                    <pre>{{pageTreeData | json}}</pre>
                                    -->
                                </div>


                                <div class="col-md-9 col-sm-9">
                                    <div>
                                        Url: {{selectedPageNode.data.source}}
                                    </div>
                                    <iframe height = "800px" width="100%" ng-src="{{page.src}}"></iframe>

                                </div>
                            </div>


                        </uib-tab>


                        <uib-tab heading="Implementation Guide Json">
                            <br/>
                            <pre>{{currentIG | json}}</pre>
                        </uib-tab>

                    </uib-tabset>


                </div>
            </div>

        </uib-tab>
        <uib-tab heading="Comparison" class="pull-right" select="input.tabShowing = 'comp'">
            <br/>

            <div class="row">
<!--
                <div class="col-md-2">

                    <select class="form-control" ng-model="input.compareResourceType"
                            ng-change="loadCompProfiles('Left')"
                            ng-options="typ.name for typ in allResourceTypes">
                    </select>
                </div>
                -->

                <div class="col-md-2">
                    <select class="form-control" ng-model="input.compareServerLeft"
                            ng-change="loadCompProfiles('Left')"
                            ng-options="svr.name for svr in appConfigSvc.getAllServers()">
                    </select>
                </div>

                <div class="col-md-4">
                    <select class="form-control" ng-model="input.profileLeft"
                            ng-change="selectCompProfile(input.profileLeft,'Left')"
                            ng-options="entry.resource.url for entry in input.matchingProfilesLeft.entry">
                    </select>
                </div>


                <div class="col-md-2" style="border-left: solid 1px gray">
                    <select class="form-control" ng-model="input.compareServerRight"
                            ng-change="loadCompProfiles('Right')"
                            ng-options="svr.name for svr in appConfigSvc.getAllServers()">
                    </select>
                </div>

                <div class="col-md-4">
                    <select class="form-control" ng-model="input.profileRight"
                            ng-change="selectCompProfile(input.profileRight,'Right')"
                            ng-options="entry.resource.url for entry in input.matchingProfilesRight.entry">
                    </select>
                </div>

            </div>






            <div class="row">
                <div class="col-md-6 myScroll">
                    <profile-table items="canonicalLeft.item" select-item="selectItem"
                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                   show-value-set-e="showValueSet"></profile-table>

                </div>
                <div class="col-md-6 myScroll" style="border-left: solid 1px gray">
                    <profile-table items="canonicalRight.item" select-item="selectItem"
                                   show-e-d-e="showED" select-extension-from-profile-e="selectExtensionFromProfile"
                                   show-value-set-e="showValueSet"></profile-table>

                </div>
            </div>




        </uib-tab>
    </uib-tabset>




    <vs-browser trigger="showVSBrowserDialog" hidesearch="true"
                vs-selected="vsSelected"></vs-browser>


</div>
</body>
</html>