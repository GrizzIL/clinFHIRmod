"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fsh_sushi_1 = require("fsh-sushi");
const utils_1 = require("../utils");
const exportable_1 = require("../../exportable");
exports.default = {
    name: 'resolve_value_set_component_rule_urls',
    description: 'Replace URLs in value set rules with their names or aliases',
    optimize(pkg, fisher) {
        pkg.valueSets.forEach(vs => {
            vs.rules.forEach(rule => {
                if (rule instanceof exportable_1.ExportableValueSetConceptComponentRule ||
                    rule instanceof exportable_1.ExportableValueSetFilterComponentRule) {
                    if (rule.from.system) {
                        rule.from.system = utils_1.optimizeURL(rule.from.system, pkg.aliases, [fsh_sushi_1.utils.Type.CodeSystem], fisher);
                    }
                    if (rule.from.valueSets) {
                        rule.from.valueSets = rule.from.valueSets.map(vsURL => {
                            return utils_1.optimizeURL(vsURL, pkg.aliases, [fsh_sushi_1.utils.Type.ValueSet], fisher);
                        });
                    }
                    if (rule instanceof exportable_1.ExportableValueSetConceptComponentRule) {
                        rule.concepts.forEach(concept => {
                            if (concept.system) {
                                concept.system = utils_1.optimizeURL(concept.system, pkg.aliases, [fsh_sushi_1.utils.Type.CodeSystem], fisher);
                            }
                        });
                    }
                }
            });
        });
    }
};
//# sourceMappingURL=ResolveValueSetComponentRuleURLsOptimizer.js.map